"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/health";
exports.ids = ["pages/api/health"];
exports.modules = {

/***/ "(api-node)/./lib/api/router.js":
/*!***************************!*\
  !*** ./lib/api/router.js ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createRoute: () => (/* binding */ createRoute),\n/* harmony export */   extractQueryParams: () => (/* binding */ extractQueryParams),\n/* harmony export */   formatPaginated: () => (/* binding */ formatPaginated),\n/* harmony export */   formatSuccess: () => (/* binding */ formatSuccess),\n/* harmony export */   handleCors: () => (/* binding */ handleCors),\n/* harmony export */   handlers: () => (/* binding */ handlers),\n/* harmony export */   logRequest: () => (/* binding */ logRequest),\n/* harmony export */   registerRoutes: () => (/* binding */ registerRoutes)\n/* harmony export */ });\n/* harmony import */ var _middleware_error__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../middleware/error */ \"(api-node)/./lib/middleware/error.js\");\n/* harmony import */ var _middleware_auth__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../middleware/auth */ \"(api-node)/./lib/middleware/auth.js\");\n/**\n * API Router\n * \n * Provides utilities for consistent API route handling, including\n * middleware application, response formatting, and error handling.\n */ \n\n/**\n * Format a successful API response\n * \n * @param {any} data - The data to include in the response\n * @param {string} message - Optional success message\n * @param {Object} meta - Optional metadata (pagination, etc.)\n * @returns {Object} - Formatted success response\n */ const formatSuccess = (data, message = null, meta = null)=>{\n    const response = {\n        success: true\n    };\n    if (message) {\n        response.message = message;\n    }\n    if (data !== undefined) {\n        response.data = data;\n    }\n    if (meta) {\n        response.meta = meta;\n    }\n    return response;\n};\n/**\n * Format a successful paginated API response\n * \n * @param {Array} items - The array of items\n * @param {number} page - Current page number\n * @param {number} limit - Items per page\n * @param {number} total - Total number of items\n * @param {string} message - Optional success message\n * @returns {Object} - Formatted paginated response\n */ const formatPaginated = (items, page, limit, total, message = null)=>{\n    const totalPages = Math.ceil(total / limit);\n    return formatSuccess({\n        items\n    }, message, {\n        pagination: {\n            page,\n            limit,\n            total,\n            totalPages,\n            hasNextPage: page < totalPages,\n            hasPrevPage: page > 1\n        }\n    });\n};\n/**\n * Log API request details\n * \n * @param {Object} req - The request object\n */ const logRequest = (req)=>{\n    if (true) {\n        console.log(`[${new Date().toISOString()}] ${req.method} ${req.url}`);\n        if (req.query && Object.keys(req.query).length > 0) {\n            console.log('  Query:', req.query);\n        }\n        if (req.body && Object.keys(req.body).length > 0) {\n            console.log('  Body:', JSON.stringify(req.body).substring(0, 200));\n        }\n        if (req.userId) {\n            console.log('  User:', req.userId);\n        }\n    }\n};\n/**\n * Handle CORS pre-flight requests\n * \n * @param {Object} req - The request object\n * @param {Object} res - The response object\n * @returns {boolean} - True if handled as preflight, false otherwise\n */ const handleCors = (req, res)=>{\n    // Set CORS headers for all responses\n    res.setHeader('Access-Control-Allow-Origin', process.env.CORS_ORIGIN || '*');\n    res.setHeader('Access-Control-Allow-Methods', 'GET, POST, PUT, DELETE, OPTIONS');\n    res.setHeader('Access-Control-Allow-Headers', 'Content-Type, Authorization, X-CSRF-Token');\n    res.setHeader('Access-Control-Allow-Credentials', 'true');\n    // Handle OPTIONS pre-flight request\n    if (req.method === 'OPTIONS') {\n        res.status(200).end();\n        return true;\n    }\n    return false;\n};\n/**\n * Create a route handler with consistent formatting and middleware\n * \n * @param {Function} handler - The route handler function\n * @param {Object} options - Options for the route\n * @param {boolean} options.auth - Whether auth is required (default: true)\n * @param {string|string[]} options.roles - Required roles, if any\n * @param {boolean} options.cors - Whether to enable CORS (default: true)\n * @param {boolean} options.csrf - Whether to enable CSRF protection (default: true)\n * @param {Object} options.rateLimit - Rate limiting options, if any\n * @returns {Function} - Enhanced route handler\n */ const createRoute = (handler, options = {})=>{\n    // Default options\n    const routeOptions = {\n        auth: true,\n        cors: true,\n        csrf: true,\n        ...options\n    };\n    // Create middleware stack based on options\n    const middleware = (0,_middleware_auth__WEBPACK_IMPORTED_MODULE_1__.secureRoute)(routeOptions);\n    // Return wrapped handler with middleware and error handling\n    return (0,_middleware_error__WEBPACK_IMPORTED_MODULE_0__.withErrorHandling)(async (req, res)=>{\n        try {\n            // Handle CORS if enabled\n            if (routeOptions.cors && handleCors(req, res)) {\n                return;\n            }\n            // Log request\n            logRequest(req);\n            // Apply middleware\n            if (middleware.length > 0) {\n                // Convert middleware chain to promise\n                await new Promise((resolve, reject)=>{\n                    // Track current middleware index\n                    let currentIndex = 0;\n                    // Create next function that moves to next middleware or resolves\n                    const next = (error)=>{\n                        if (error) {\n                            reject(error);\n                            return;\n                        }\n                        currentIndex++;\n                        if (currentIndex >= middleware.length) {\n                            resolve();\n                            return;\n                        }\n                        try {\n                            middleware[currentIndex](req, res, next);\n                        } catch (err) {\n                            reject(err);\n                        }\n                    };\n                    // Start middleware chain\n                    middleware[0](req, res, next);\n                });\n            }\n            // Call the actual route handler\n            return await handler(req, res);\n        } catch (error) {\n            // Let withErrorHandling handle any errors\n            throw error;\n        }\n    });\n};\n/**\n * Register routes with a router\n * \n * @param {Object} router - Next.js API router\n * @param {Object} routes - Routes configuration\n * @param {Function} routes.GET - GET request handler\n * @param {Function} routes.POST - POST request handler\n * @param {Function} routes.PUT - PUT request handler\n * @param {Function} routes.DELETE - DELETE request handler\n * @param {Object} options - Options for all routes\n * @returns {Function} - Router handler\n */ const registerRoutes = (routes, options = {})=>{\n    // Return Next.js API route handler\n    return async (req, res)=>{\n        const method = req.method || 'GET';\n        // Check if method is supported\n        if (routes[method]) {\n            // Create route handler with options\n            const handler = createRoute(routes[method], options);\n            // Call handler\n            return await handler(req, res);\n        }\n        // Method not allowed\n        res.setHeader('Allow', Object.keys(routes));\n        return res.status(405).json({\n            success: false,\n            message: 'Method not allowed'\n        });\n    };\n};\n/**\n * Utility to extract query parameters with defaults\n * \n * @param {Object} query - Next.js query object\n * @param {Object} defaults - Default values for params\n * @returns {Object} - Processed query parameters\n */ const extractQueryParams = (query, defaults = {})=>{\n    const params = {\n        ...defaults\n    };\n    // Process page and limit for pagination\n    if ('page' in query) {\n        params.page = parseInt(query.page, 10) || defaults.page || 1;\n    }\n    if ('limit' in query) {\n        params.limit = parseInt(query.limit, 10) || defaults.limit || 10;\n    }\n    // Process dates\n    if ('startDate' in query && query.startDate) {\n        params.startDate = query.startDate;\n    }\n    if ('endDate' in query && query.endDate) {\n        params.endDate = query.endDate;\n    }\n    // Process amount filters\n    if ('minAmount' in query && query.minAmount) {\n        params.minAmount = parseFloat(query.minAmount);\n    }\n    if ('maxAmount' in query && query.maxAmount) {\n        params.maxAmount = parseFloat(query.maxAmount);\n    }\n    // Process sorting\n    if ('sortBy' in query && query.sortBy) {\n        params.sortBy = query.sortBy;\n    }\n    if ('sortDir' in query && query.sortDir) {\n        params.sortDir = query.sortDir.toLowerCase() === 'asc' ? 'asc' : 'desc';\n    }\n    // Process other parameters\n    for(const key in query){\n        if (!(key in params)) {\n            params[key] = query[key];\n        }\n    }\n    return params;\n};\n/**\n * Common request handlers that can be reused across endpoints\n */ const handlers = {\n    /**\n   * Create a simple health check route handler\n   */ healthCheck: (req, res)=>{\n        res.status(200).json(formatSuccess({\n            status: 'healthy'\n        }, 'API is running'));\n    },\n    /**\n   * Create a simple documentation route handler\n   */ documentation: (docData)=>(req, res)=>{\n            res.status(200).json(formatSuccess(docData, 'API documentation'));\n        }\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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TUFBTSxHQUFHM0MsTUFBTTJDLE1BQU07SUFDOUI7SUFFQSxJQUFJLGFBQWEzQyxTQUFTQSxNQUFNNEMsT0FBTyxFQUFFO1FBQ3ZDUixPQUFPUSxPQUFPLEdBQUc1QyxNQUFNNEMsT0FBTyxDQUFDQyxXQUFXLE9BQU8sUUFBUSxRQUFRO0lBQ25FO0lBRUEsMkJBQTJCO0lBQzNCLElBQUssTUFBTUMsT0FBTzlDLE1BQU87UUFDdkIsSUFBSSxDQUFFOEMsQ0FBQUEsT0FBT1YsTUFBSyxHQUFJO1lBQ3BCQSxNQUFNLENBQUNVLElBQUksR0FBRzlDLEtBQUssQ0FBQzhDLElBQUk7UUFDMUI7SUFDRjtJQUVBLE9BQU9WO0FBQ1QsRUFBRTtBQUVGOztDQUVDLEdBQ00sTUFBTVcsV0FBVztJQUN0Qjs7R0FFQyxHQUNEQyxhQUFhLENBQUN4RCxLQUFLa0I7UUFDakJBLElBQUlJLE1BQU0sQ0FBQyxLQUFLbUIsSUFBSSxDQUFDNUQsY0FBYztZQUFFeUMsUUFBUTtRQUFVLEdBQUc7SUFDNUQ7SUFFQTs7R0FFQyxHQUNEbUMsZUFBZSxDQUFDQyxVQUFZLENBQUMxRCxLQUFLa0I7WUFDaENBLElBQUlJLE1BQU0sQ0FBQyxLQUFLbUIsSUFBSSxDQUFDNUQsY0FBYzZFLFNBQVM7UUFDOUM7QUFDRixFQUFFIiwic291cmNlcyI6WyIvVXNlcnMva2V2aW56dW5pZ2EvRGV2ZWxvcG1lbnQva2V2aW4vZmxvd2FwcC9tb25leS1mbG93L2xpYi9hcGkvcm91dGVyLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQVBJIFJvdXRlclxuICogXG4gKiBQcm92aWRlcyB1dGlsaXRpZXMgZm9yIGNvbnNpc3RlbnQgQVBJIHJvdXRlIGhhbmRsaW5nLCBpbmNsdWRpbmdcbiAqIG1pZGRsZXdhcmUgYXBwbGljYXRpb24sIHJlc3BvbnNlIGZvcm1hdHRpbmcsIGFuZCBlcnJvciBoYW5kbGluZy5cbiAqL1xuXG5pbXBvcnQgeyB3aXRoRXJyb3JIYW5kbGluZyB9IGZyb20gJy4uL21pZGRsZXdhcmUvZXJyb3InO1xuaW1wb3J0IHsgc2VjdXJlUm91dGUgfSBmcm9tICcuLi9taWRkbGV3YXJlL2F1dGgnO1xuXG4vKipcbiAqIEZvcm1hdCBhIHN1Y2Nlc3NmdWwgQVBJIHJlc3BvbnNlXG4gKiBcbiAqIEBwYXJhbSB7YW55fSBkYXRhIC0gVGhlIGRhdGEgdG8gaW5jbHVkZSBpbiB0aGUgcmVzcG9uc2VcbiAqIEBwYXJhbSB7c3RyaW5nfSBtZXNzYWdlIC0gT3B0aW9uYWwgc3VjY2VzcyBtZXNzYWdlXG4gKiBAcGFyYW0ge09iamVjdH0gbWV0YSAtIE9wdGlvbmFsIG1ldGFkYXRhIChwYWdpbmF0aW9uLCBldGMuKVxuICogQHJldHVybnMge09iamVjdH0gLSBGb3JtYXR0ZWQgc3VjY2VzcyByZXNwb25zZVxuICovXG5leHBvcnQgY29uc3QgZm9ybWF0U3VjY2VzcyA9IChkYXRhLCBtZXNzYWdlID0gbnVsbCwgbWV0YSA9IG51bGwpID0+IHtcbiAgY29uc3QgcmVzcG9uc2UgPSB7XG4gICAgc3VjY2VzczogdHJ1ZVxuICB9O1xuICBcbiAgaWYgKG1lc3NhZ2UpIHtcbiAgICByZXNwb25zZS5tZXNzYWdlID0gbWVzc2FnZTtcbiAgfVxuICBcbiAgaWYgKGRhdGEgIT09IHVuZGVmaW5lZCkge1xuICAgIHJlc3BvbnNlLmRhdGEgPSBkYXRhO1xuICB9XG4gIFxuICBpZiAobWV0YSkge1xuICAgIHJlc3BvbnNlLm1ldGEgPSBtZXRhO1xuICB9XG4gIFxuICByZXR1cm4gcmVzcG9uc2U7XG59O1xuXG4vKipcbiAqIEZvcm1hdCBhIHN1Y2Nlc3NmdWwgcGFnaW5hdGVkIEFQSSByZXNwb25zZVxuICogXG4gKiBAcGFyYW0ge0FycmF5fSBpdGVtcyAtIFRoZSBhcnJheSBvZiBpdGVtc1xuICogQHBhcmFtIHtudW1iZXJ9IHBhZ2UgLSBDdXJyZW50IHBhZ2UgbnVtYmVyXG4gKiBAcGFyYW0ge251bWJlcn0gbGltaXQgLSBJdGVtcyBwZXIgcGFnZVxuICogQHBhcmFtIHtudW1iZXJ9IHRvdGFsIC0gVG90YWwgbnVtYmVyIG9mIGl0ZW1zXG4gKiBAcGFyYW0ge3N0cmluZ30gbWVzc2FnZSAtIE9wdGlvbmFsIHN1Y2Nlc3MgbWVzc2FnZVxuICogQHJldHVybnMge09iamVjdH0gLSBGb3JtYXR0ZWQgcGFnaW5hdGVkIHJlc3BvbnNlXG4gKi9cbmV4cG9ydCBjb25zdCBmb3JtYXRQYWdpbmF0ZWQgPSAoaXRlbXMsIHBhZ2UsIGxpbWl0LCB0b3RhbCwgbWVzc2FnZSA9IG51bGwpID0+IHtcbiAgY29uc3QgdG90YWxQYWdlcyA9IE1hdGguY2VpbCh0b3RhbCAvIGxpbWl0KTtcbiAgXG4gIHJldHVybiBmb3JtYXRTdWNjZXNzKFxuICAgIHsgaXRlbXMgfSxcbiAgICBtZXNzYWdlLFxuICAgIHtcbiAgICAgIHBhZ2luYXRpb246IHtcbiAgICAgICAgcGFnZSxcbiAgICAgICAgbGltaXQsXG4gICAgICAgIHRvdGFsLFxuICAgICAgICB0b3RhbFBhZ2VzLFxuICAgICAgICBoYXNOZXh0UGFnZTogcGFnZSA8IHRvdGFsUGFnZXMsXG4gICAgICAgIGhhc1ByZXZQYWdlOiBwYWdlID4gMVxuICAgICAgfVxuICAgIH1cbiAgKTtcbn07XG5cbi8qKlxuICogTG9nIEFQSSByZXF1ZXN0IGRldGFpbHNcbiAqIFxuICogQHBhcmFtIHtPYmplY3R9IHJlcSAtIFRoZSByZXF1ZXN0IG9iamVjdFxuICovXG5leHBvcnQgY29uc3QgbG9nUmVxdWVzdCA9IChyZXEpID0+IHtcbiAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAnZGV2ZWxvcG1lbnQnKSB7XG4gICAgY29uc29sZS5sb2coYFske25ldyBEYXRlKCkudG9JU09TdHJpbmcoKX1dICR7cmVxLm1ldGhvZH0gJHtyZXEudXJsfWApO1xuICAgIFxuICAgIGlmIChyZXEucXVlcnkgJiYgT2JqZWN0LmtleXMocmVxLnF1ZXJ5KS5sZW5ndGggPiAwKSB7XG4gICAgICBjb25zb2xlLmxvZygnICBRdWVyeTonLCByZXEucXVlcnkpO1xuICAgIH1cbiAgICBcbiAgICBpZiAocmVxLmJvZHkgJiYgT2JqZWN0LmtleXMocmVxLmJvZHkpLmxlbmd0aCA+IDApIHtcbiAgICAgIGNvbnNvbGUubG9nKCcgIEJvZHk6JywgSlNPTi5zdHJpbmdpZnkocmVxLmJvZHkpLnN1YnN0cmluZygwLCAyMDApKTtcbiAgICB9XG4gICAgXG4gICAgaWYgKHJlcS51c2VySWQpIHtcbiAgICAgIGNvbnNvbGUubG9nKCcgIFVzZXI6JywgcmVxLnVzZXJJZCk7XG4gICAgfVxuICB9XG59O1xuXG4vKipcbiAqIEhhbmRsZSBDT1JTIHByZS1mbGlnaHQgcmVxdWVzdHNcbiAqIFxuICogQHBhcmFtIHtPYmplY3R9IHJlcSAtIFRoZSByZXF1ZXN0IG9iamVjdFxuICogQHBhcmFtIHtPYmplY3R9IHJlcyAtIFRoZSByZXNwb25zZSBvYmplY3RcbiAqIEByZXR1cm5zIHtib29sZWFufSAtIFRydWUgaWYgaGFuZGxlZCBhcyBwcmVmbGlnaHQsIGZhbHNlIG90aGVyd2lzZVxuICovXG5leHBvcnQgY29uc3QgaGFuZGxlQ29ycyA9IChyZXEsIHJlcykgPT4ge1xuICAvLyBTZXQgQ09SUyBoZWFkZXJzIGZvciBhbGwgcmVzcG9uc2VzXG4gIHJlcy5zZXRIZWFkZXIoJ0FjY2Vzcy1Db250cm9sLUFsbG93LU9yaWdpbicsIHByb2Nlc3MuZW52LkNPUlNfT1JJR0lOIHx8ICcqJyk7XG4gIHJlcy5zZXRIZWFkZXIoJ0FjY2Vzcy1Db250cm9sLUFsbG93LU1ldGhvZHMnLCAnR0VULCBQT1NULCBQVVQsIERFTEVURSwgT1BUSU9OUycpO1xuICByZXMuc2V0SGVhZGVyKCdBY2Nlc3MtQ29udHJvbC1BbGxvdy1IZWFkZXJzJywgJ0NvbnRlbnQtVHlwZSwgQXV0aG9yaXphdGlvbiwgWC1DU1JGLVRva2VuJyk7XG4gIHJlcy5zZXRIZWFkZXIoJ0FjY2Vzcy1Db250cm9sLUFsbG93LUNyZWRlbnRpYWxzJywgJ3RydWUnKTtcbiAgXG4gIC8vIEhhbmRsZSBPUFRJT05TIHByZS1mbGlnaHQgcmVxdWVzdFxuICBpZiAocmVxLm1ldGhvZCA9PT0gJ09QVElPTlMnKSB7XG4gICAgcmVzLnN0YXR1cygyMDApLmVuZCgpO1xuICAgIHJldHVybiB0cnVlO1xuICB9XG4gIFxuICByZXR1cm4gZmFsc2U7XG59O1xuXG4vKipcbiAqIENyZWF0ZSBhIHJvdXRlIGhhbmRsZXIgd2l0aCBjb25zaXN0ZW50IGZvcm1hdHRpbmcgYW5kIG1pZGRsZXdhcmVcbiAqIFxuICogQHBhcmFtIHtGdW5jdGlvbn0gaGFuZGxlciAtIFRoZSByb3V0ZSBoYW5kbGVyIGZ1bmN0aW9uXG4gKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucyAtIE9wdGlvbnMgZm9yIHRoZSByb3V0ZVxuICogQHBhcmFtIHtib29sZWFufSBvcHRpb25zLmF1dGggLSBXaGV0aGVyIGF1dGggaXMgcmVxdWlyZWQgKGRlZmF1bHQ6IHRydWUpXG4gKiBAcGFyYW0ge3N0cmluZ3xzdHJpbmdbXX0gb3B0aW9ucy5yb2xlcyAtIFJlcXVpcmVkIHJvbGVzLCBpZiBhbnlcbiAqIEBwYXJhbSB7Ym9vbGVhbn0gb3B0aW9ucy5jb3JzIC0gV2hldGhlciB0byBlbmFibGUgQ09SUyAoZGVmYXVsdDogdHJ1ZSlcbiAqIEBwYXJhbSB7Ym9vbGVhbn0gb3B0aW9ucy5jc3JmIC0gV2hldGhlciB0byBlbmFibGUgQ1NSRiBwcm90ZWN0aW9uIChkZWZhdWx0OiB0cnVlKVxuICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMucmF0ZUxpbWl0IC0gUmF0ZSBsaW1pdGluZyBvcHRpb25zLCBpZiBhbnlcbiAqIEByZXR1cm5zIHtGdW5jdGlvbn0gLSBFbmhhbmNlZCByb3V0ZSBoYW5kbGVyXG4gKi9cbmV4cG9ydCBjb25zdCBjcmVhdGVSb3V0ZSA9IChoYW5kbGVyLCBvcHRpb25zID0ge30pID0+IHtcbiAgLy8gRGVmYXVsdCBvcHRpb25zXG4gIGNvbnN0IHJvdXRlT3B0aW9ucyA9IHtcbiAgICBhdXRoOiB0cnVlLFxuICAgIGNvcnM6IHRydWUsXG4gICAgY3NyZjogdHJ1ZSxcbiAgICAuLi5vcHRpb25zXG4gIH07XG4gIFxuICAvLyBDcmVhdGUgbWlkZGxld2FyZSBzdGFjayBiYXNlZCBvbiBvcHRpb25zXG4gIGNvbnN0IG1pZGRsZXdhcmUgPSBzZWN1cmVSb3V0ZShyb3V0ZU9wdGlvbnMpO1xuICBcbiAgLy8gUmV0dXJuIHdyYXBwZWQgaGFuZGxlciB3aXRoIG1pZGRsZXdhcmUgYW5kIGVycm9yIGhhbmRsaW5nXG4gIHJldHVybiB3aXRoRXJyb3JIYW5kbGluZyhhc3luYyAocmVxLCByZXMpID0+IHtcbiAgICB0cnkge1xuICAgICAgLy8gSGFuZGxlIENPUlMgaWYgZW5hYmxlZFxuICAgICAgaWYgKHJvdXRlT3B0aW9ucy5jb3JzICYmIGhhbmRsZUNvcnMocmVxLCByZXMpKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gTG9nIHJlcXVlc3RcbiAgICAgIGxvZ1JlcXVlc3QocmVxKTtcbiAgICAgIFxuICAgICAgLy8gQXBwbHkgbWlkZGxld2FyZVxuICAgICAgaWYgKG1pZGRsZXdhcmUubGVuZ3RoID4gMCkge1xuICAgICAgICAvLyBDb252ZXJ0IG1pZGRsZXdhcmUgY2hhaW4gdG8gcHJvbWlzZVxuICAgICAgICBhd2FpdCBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgLy8gVHJhY2sgY3VycmVudCBtaWRkbGV3YXJlIGluZGV4XG4gICAgICAgICAgbGV0IGN1cnJlbnRJbmRleCA9IDA7XG4gICAgICAgICAgXG4gICAgICAgICAgLy8gQ3JlYXRlIG5leHQgZnVuY3Rpb24gdGhhdCBtb3ZlcyB0byBuZXh0IG1pZGRsZXdhcmUgb3IgcmVzb2x2ZXNcbiAgICAgICAgICBjb25zdCBuZXh0ID0gKGVycm9yKSA9PiB7XG4gICAgICAgICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgcmVqZWN0KGVycm9yKTtcbiAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICBjdXJyZW50SW5kZXgrKztcbiAgICAgICAgICAgIGlmIChjdXJyZW50SW5kZXggPj0gbWlkZGxld2FyZS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgIG1pZGRsZXdhcmVbY3VycmVudEluZGV4XShyZXEsIHJlcywgbmV4dCk7XG4gICAgICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgICAgcmVqZWN0KGVycik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfTtcbiAgICAgICAgICBcbiAgICAgICAgICAvLyBTdGFydCBtaWRkbGV3YXJlIGNoYWluXG4gICAgICAgICAgbWlkZGxld2FyZVswXShyZXEsIHJlcywgbmV4dCk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBDYWxsIHRoZSBhY3R1YWwgcm91dGUgaGFuZGxlclxuICAgICAgcmV0dXJuIGF3YWl0IGhhbmRsZXIocmVxLCByZXMpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAvLyBMZXQgd2l0aEVycm9ySGFuZGxpbmcgaGFuZGxlIGFueSBlcnJvcnNcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfSk7XG59O1xuXG4vKipcbiAqIFJlZ2lzdGVyIHJvdXRlcyB3aXRoIGEgcm91dGVyXG4gKiBcbiAqIEBwYXJhbSB7T2JqZWN0fSByb3V0ZXIgLSBOZXh0LmpzIEFQSSByb3V0ZXJcbiAqIEBwYXJhbSB7T2JqZWN0fSByb3V0ZXMgLSBSb3V0ZXMgY29uZmlndXJhdGlvblxuICogQHBhcmFtIHtGdW5jdGlvbn0gcm91dGVzLkdFVCAtIEdFVCByZXF1ZXN0IGhhbmRsZXJcbiAqIEBwYXJhbSB7RnVuY3Rpb259IHJvdXRlcy5QT1NUIC0gUE9TVCByZXF1ZXN0IGhhbmRsZXJcbiAqIEBwYXJhbSB7RnVuY3Rpb259IHJvdXRlcy5QVVQgLSBQVVQgcmVxdWVzdCBoYW5kbGVyXG4gKiBAcGFyYW0ge0Z1bmN0aW9ufSByb3V0ZXMuREVMRVRFIC0gREVMRVRFIHJlcXVlc3QgaGFuZGxlclxuICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMgLSBPcHRpb25zIGZvciBhbGwgcm91dGVzXG4gKiBAcmV0dXJucyB7RnVuY3Rpb259IC0gUm91dGVyIGhhbmRsZXJcbiAqL1xuZXhwb3J0IGNvbnN0IHJlZ2lzdGVyUm91dGVzID0gKHJvdXRlcywgb3B0aW9ucyA9IHt9KSA9PiB7XG4gIC8vIFJldHVybiBOZXh0LmpzIEFQSSByb3V0ZSBoYW5kbGVyXG4gIHJldHVybiBhc3luYyAocmVxLCByZXMpID0+IHtcbiAgICBjb25zdCBtZXRob2QgPSByZXEubWV0aG9kIHx8ICdHRVQnO1xuICAgIFxuICAgIC8vIENoZWNrIGlmIG1ldGhvZCBpcyBzdXBwb3J0ZWRcbiAgICBpZiAocm91dGVzW21ldGhvZF0pIHtcbiAgICAgIC8vIENyZWF0ZSByb3V0ZSBoYW5kbGVyIHdpdGggb3B0aW9uc1xuICAgICAgY29uc3QgaGFuZGxlciA9IGNyZWF0ZVJvdXRlKHJvdXRlc1ttZXRob2RdLCBvcHRpb25zKTtcbiAgICAgIC8vIENhbGwgaGFuZGxlclxuICAgICAgcmV0dXJuIGF3YWl0IGhhbmRsZXIocmVxLCByZXMpO1xuICAgIH1cbiAgICBcbiAgICAvLyBNZXRob2Qgbm90IGFsbG93ZWRcbiAgICByZXMuc2V0SGVhZGVyKCdBbGxvdycsIE9iamVjdC5rZXlzKHJvdXRlcykpO1xuICAgIHJldHVybiByZXMuc3RhdHVzKDQwNSkuanNvbih7XG4gICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgIG1lc3NhZ2U6ICdNZXRob2Qgbm90IGFsbG93ZWQnXG4gICAgfSk7XG4gIH07XG59O1xuXG4vKipcbiAqIFV0aWxpdHkgdG8gZXh0cmFjdCBxdWVyeSBwYXJhbWV0ZXJzIHdpdGggZGVmYXVsdHNcbiAqIFxuICogQHBhcmFtIHtPYmplY3R9IHF1ZXJ5IC0gTmV4dC5qcyBxdWVyeSBvYmplY3RcbiAqIEBwYXJhbSB7T2JqZWN0fSBkZWZhdWx0cyAtIERlZmF1bHQgdmFsdWVzIGZvciBwYXJhbXNcbiAqIEByZXR1cm5zIHtPYmplY3R9IC0gUHJvY2Vzc2VkIHF1ZXJ5IHBhcmFtZXRlcnNcbiAqL1xuZXhwb3J0IGNvbnN0IGV4dHJhY3RRdWVyeVBhcmFtcyA9IChxdWVyeSwgZGVmYXVsdHMgPSB7fSkgPT4ge1xuICBjb25zdCBwYXJhbXMgPSB7IC4uLmRlZmF1bHRzIH07XG4gIFxuICAvLyBQcm9jZXNzIHBhZ2UgYW5kIGxpbWl0IGZvciBwYWdpbmF0aW9uXG4gIGlmICgncGFnZScgaW4gcXVlcnkpIHtcbiAgICBwYXJhbXMucGFnZSA9IHBhcnNlSW50KHF1ZXJ5LnBhZ2UsIDEwKSB8fCBkZWZhdWx0cy5wYWdlIHx8IDE7XG4gIH1cbiAgXG4gIGlmICgnbGltaXQnIGluIHF1ZXJ5KSB7XG4gICAgcGFyYW1zLmxpbWl0ID0gcGFyc2VJbnQocXVlcnkubGltaXQsIDEwKSB8fCBkZWZhdWx0cy5saW1pdCB8fCAxMDtcbiAgfVxuICBcbiAgLy8gUHJvY2VzcyBkYXRlc1xuICBpZiAoJ3N0YXJ0RGF0ZScgaW4gcXVlcnkgJiYgcXVlcnkuc3RhcnREYXRlKSB7XG4gICAgcGFyYW1zLnN0YXJ0RGF0ZSA9IHF1ZXJ5LnN0YXJ0RGF0ZTtcbiAgfVxuICBcbiAgaWYgKCdlbmREYXRlJyBpbiBxdWVyeSAmJiBxdWVyeS5lbmREYXRlKSB7XG4gICAgcGFyYW1zLmVuZERhdGUgPSBxdWVyeS5lbmREYXRlO1xuICB9XG4gIFxuICAvLyBQcm9jZXNzIGFtb3VudCBmaWx0ZXJzXG4gIGlmICgnbWluQW1vdW50JyBpbiBxdWVyeSAmJiBxdWVyeS5taW5BbW91bnQpIHtcbiAgICBwYXJhbXMubWluQW1vdW50ID0gcGFyc2VGbG9hdChxdWVyeS5taW5BbW91bnQpO1xuICB9XG4gIFxuICBpZiAoJ21heEFtb3VudCcgaW4gcXVlcnkgJiYgcXVlcnkubWF4QW1vdW50KSB7XG4gICAgcGFyYW1zLm1heEFtb3VudCA9IHBhcnNlRmxvYXQocXVlcnkubWF4QW1vdW50KTtcbiAgfVxuICBcbiAgLy8gUHJvY2VzcyBzb3J0aW5nXG4gIGlmICgnc29ydEJ5JyBpbiBxdWVyeSAmJiBxdWVyeS5zb3J0QnkpIHtcbiAgICBwYXJhbXMuc29ydEJ5ID0gcXVlcnkuc29ydEJ5O1xuICB9XG4gIFxuICBpZiAoJ3NvcnREaXInIGluIHF1ZXJ5ICYmIHF1ZXJ5LnNvcnREaXIpIHtcbiAgICBwYXJhbXMuc29ydERpciA9IHF1ZXJ5LnNvcnREaXIudG9Mb3dlckNhc2UoKSA9PT0gJ2FzYycgPyAnYXNjJyA6ICdkZXNjJztcbiAgfVxuICBcbiAgLy8gUHJvY2VzcyBvdGhlciBwYXJhbWV0ZXJzXG4gIGZvciAoY29uc3Qga2V5IGluIHF1ZXJ5KSB7XG4gICAgaWYgKCEoa2V5IGluIHBhcmFtcykpIHtcbiAgICAgIHBhcmFtc1trZXldID0gcXVlcnlba2V5XTtcbiAgICB9XG4gIH1cbiAgXG4gIHJldHVybiBwYXJhbXM7XG59O1xuXG4vKipcbiAqIENvbW1vbiByZXF1ZXN0IGhhbmRsZXJzIHRoYXQgY2FuIGJlIHJldXNlZCBhY3Jvc3MgZW5kcG9pbnRzXG4gKi9cbmV4cG9ydCBjb25zdCBoYW5kbGVycyA9IHtcbiAgLyoqXG4gICAqIENyZWF0ZSBhIHNpbXBsZSBoZWFsdGggY2hlY2sgcm91dGUgaGFuZGxlclxuICAgKi9cbiAgaGVhbHRoQ2hlY2s6IChyZXEsIHJlcykgPT4ge1xuICAgIHJlcy5zdGF0dXMoMjAwKS5qc29uKGZvcm1hdFN1Y2Nlc3MoeyBzdGF0dXM6ICdoZWFsdGh5JyB9LCAnQVBJIGlzIHJ1bm5pbmcnKSk7XG4gIH0sXG4gIFxuICAvKipcbiAgICogQ3JlYXRlIGEgc2ltcGxlIGRvY3VtZW50YXRpb24gcm91dGUgaGFuZGxlclxuICAgKi9cbiAgZG9jdW1lbnRhdGlvbjogKGRvY0RhdGEpID0+IChyZXEsIHJlcykgPT4ge1xuICAgIHJlcy5zdGF0dXMoMjAwKS5qc29uKGZvcm1hdFN1Y2Nlc3MoZG9jRGF0YSwgJ0FQSSBkb2N1bWVudGF0aW9uJykpO1xuICB9XG59O1xuXG4iXSwibmFtZXMiOlsid2l0aEVycm9ySGFuZGxpbmciLCJzZWN1cmVSb3V0ZSIsImZvcm1hdFN1Y2Nlc3MiLCJkYXRhIiwibWVzc2FnZSIsIm1ldGEiLCJyZXNwb25zZSIsInN1Y2Nlc3MiLCJ1bmRlZmluZWQiLCJmb3JtYXRQYWdpbmF0ZWQiLCJpdGVtcyIsInBhZ2UiLCJsaW1pdCIsInRvdGFsIiwidG90YWxQYWdlcyIsIk1hdGgiLCJjZWlsIiwicGFnaW5hdGlvbiIsImhhc05leHRQYWdlIiwiaGFzUHJldlBhZ2UiLCJsb2dSZXF1ZXN0IiwicmVxIiwicHJvY2VzcyIsImNvbnNvbGUiLCJsb2ciLCJEYXRlIiwidG9JU09TdHJpbmciLCJtZXRob2QiLCJ1cmwiLCJxdWVyeSIsIk9iamVjdCIsImtleXMiLCJsZW5ndGgiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsInN1YnN0cmluZyIsInVzZXJJZCIsImhhbmRsZUNvcnMiLCJyZXMiLCJzZXRIZWFkZXIiLCJlbnYiLCJDT1JTX09SSUdJTiIsInN0YXR1cyIsImVuZCIsImNyZWF0ZVJvdXRlIiwiaGFuZGxlciIsIm9wdGlvbnMiLCJyb3V0ZU9wdGlvbnMiLCJhdXRoIiwiY29ycyIsImNzcmYiLCJtaWRkbGV3YXJlIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJjdXJyZW50SW5kZXgiLCJuZXh0IiwiZXJyb3IiLCJlcnIiLCJyZWdpc3RlclJvdXRlcyIsInJvdXRlcyIsImpzb24iLCJleHRyYWN0UXVlcnlQYXJhbXMiLCJkZWZhdWx0cyIsInBhcmFtcyIsInBhcnNlSW50Iiwic3RhcnREYXRlIiwiZW5kRGF0ZSIsIm1pbkFtb3VudCIsInBhcnNlRmxvYXQiLCJtYXhBbW91bnQiLCJzb3J0QnkiLCJzb3J0RGlyIiwidG9Mb3dlckNhc2UiLCJrZXkiLCJoYW5kbGVycyIsImhlYWx0aENoZWNrIiwiZG9jdW1lbnRhdGlvbiIsImRvY0RhdGEiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api-node)/./lib/api/router.js\n");

/***/ }),

/***/ "(api-node)/./lib/db.js":
/*!*******************!*\
  !*** ./lib/db.js ***!
  \*******************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var pg__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! pg */ \"pg\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([pg__WEBPACK_IMPORTED_MODULE_0__]);\npg__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n// Create PostgreSQL connection pool\nconst pool = new pg__WEBPACK_IMPORTED_MODULE_0__.Pool({\n    connectionString: process.env.DATABASE_URL || 'postgresql://postgres:password@localhost:5432/money_flow',\n    ssl:  false ? 0 : false\n});\n// Log database connection errors\npool.on('error', (err)=>{\n    console.error('Unexpected error on idle client', err);\n    process.exit(-1);\n});\n// Execute SQL query with parameters\nconst query = async (text, params = [])=>{\n    const start = Date.now();\n    try {\n        const res = await pool.query(text, params);\n        const duration = Date.now() - start;\n        // Log slow queries (> 200ms) for debugging\n        if (duration > 200) {\n            console.log('Slow query:', {\n                text,\n                duration,\n                rows: res.rowCount\n            });\n        }\n        return res;\n    } catch (error) {\n        console.error('Database query error:', error);\n        // Add more context to the error for debugging\n        error.query = text;\n        error.params = params;\n        throw error;\n    }\n};\n// Get a client from the pool for transactions\nconst getClient = async ()=>{\n    const client = await pool.connect();\n    // Monkey patch the query method to implement the same logic as above\n    const originalQuery = client.query;\n    client.query = async (text, params = [])=>{\n        const start = Date.now();\n        try {\n            const res = await originalQuery.call(client, text, params);\n            const duration = Date.now() - start;\n            if (duration > 200) {\n                console.log('Slow query in transaction:', {\n                    text,\n                    duration,\n                    rows: res.rowCount\n                });\n            }\n            return res;\n        } catch (error) {\n            console.error('Database transaction query error:', error);\n            error.query = text;\n            error.params = params;\n            throw error;\n        }\n    };\n    return client;\n};\n// Run a function within a transaction\nconst transaction = async (callback)=>{\n    const client = await getClient();\n    try {\n        await client.query('BEGIN');\n        const result = await callback(client);\n        await client.query('COMMIT');\n        return result;\n    } catch (error) {\n        await client.query('ROLLBACK');\n        throw error;\n    } finally{\n        client.release();\n    }\n};\n// Export database operations\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({\n    query,\n    getClient,\n    transaction,\n    pool\n});\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL2xpYi9kYi5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUEwQjtBQUUxQixvQ0FBb0M7QUFDcEMsTUFBTUMsT0FBTyxJQUFJRCxvQ0FBSUEsQ0FBQztJQUNwQkUsa0JBQWtCQyxRQUFRQyxHQUFHLENBQUNDLFlBQVksSUFBSTtJQUM5Q0MsS0FBS0gsTUFBcUMsR0FBRyxDQUE2QixHQUFHO0FBQy9FO0FBRUEsaUNBQWlDO0FBQ2pDRixLQUFLTyxFQUFFLENBQUMsU0FBUyxDQUFDQztJQUNoQkMsUUFBUUMsS0FBSyxDQUFDLG1DQUFtQ0Y7SUFDakROLFFBQVFTLElBQUksQ0FBQyxDQUFDO0FBQ2hCO0FBRUEsb0NBQW9DO0FBQ3BDLE1BQU1DLFFBQVEsT0FBT0MsTUFBTUMsU0FBUyxFQUFFO0lBQ3BDLE1BQU1DLFFBQVFDLEtBQUtDLEdBQUc7SUFDdEIsSUFBSTtRQUNGLE1BQU1DLE1BQU0sTUFBTWxCLEtBQUtZLEtBQUssQ0FBQ0MsTUFBTUM7UUFDbkMsTUFBTUssV0FBV0gsS0FBS0MsR0FBRyxLQUFLRjtRQUU5QiwyQ0FBMkM7UUFDM0MsSUFBSUksV0FBVyxLQUFLO1lBQ2xCVixRQUFRVyxHQUFHLENBQUMsZUFBZTtnQkFBRVA7Z0JBQU1NO2dCQUFVRSxNQUFNSCxJQUFJSSxRQUFRO1lBQUM7UUFDbEU7UUFFQSxPQUFPSjtJQUNULEVBQUUsT0FBT1IsT0FBTztRQUNkRCxRQUFRQyxLQUFLLENBQUMseUJBQXlCQTtRQUV2Qyw4Q0FBOEM7UUFDOUNBLE1BQU1FLEtBQUssR0FBR0M7UUFDZEgsTUFBTUksTUFBTSxHQUFHQTtRQUVmLE1BQU1KO0lBQ1I7QUFDRjtBQUVBLDhDQUE4QztBQUM5QyxNQUFNYSxZQUFZO0lBQ2hCLE1BQU1DLFNBQVMsTUFBTXhCLEtBQUt5QixPQUFPO0lBRWpDLHFFQUFxRTtJQUNyRSxNQUFNQyxnQkFBZ0JGLE9BQU9aLEtBQUs7SUFDbENZLE9BQU9aLEtBQUssR0FBRyxPQUFPQyxNQUFNQyxTQUFTLEVBQUU7UUFDckMsTUFBTUMsUUFBUUMsS0FBS0MsR0FBRztRQUN0QixJQUFJO1lBQ0YsTUFBTUMsTUFBTSxNQUFNUSxjQUFjQyxJQUFJLENBQUNILFFBQVFYLE1BQU1DO1lBQ25ELE1BQU1LLFdBQVdILEtBQUtDLEdBQUcsS0FBS0Y7WUFFOUIsSUFBSUksV0FBVyxLQUFLO2dCQUNsQlYsUUFBUVcsR0FBRyxDQUFDLDhCQUE4QjtvQkFBRVA7b0JBQU1NO29CQUFVRSxNQUFNSCxJQUFJSSxRQUFRO2dCQUFDO1lBQ2pGO1lBRUEsT0FBT0o7UUFDVCxFQUFFLE9BQU9SLE9BQU87WUFDZEQsUUFBUUMsS0FBSyxDQUFDLHFDQUFxQ0E7WUFDbkRBLE1BQU1FLEtBQUssR0FBR0M7WUFDZEgsTUFBTUksTUFBTSxHQUFHQTtZQUNmLE1BQU1KO1FBQ1I7SUFDRjtJQUVBLE9BQU9jO0FBQ1Q7QUFFQSxzQ0FBc0M7QUFDdEMsTUFBTUksY0FBYyxPQUFPQztJQUN6QixNQUFNTCxTQUFTLE1BQU1EO0lBRXJCLElBQUk7UUFDRixNQUFNQyxPQUFPWixLQUFLLENBQUM7UUFDbkIsTUFBTWtCLFNBQVMsTUFBTUQsU0FBU0w7UUFDOUIsTUFBTUEsT0FBT1osS0FBSyxDQUFDO1FBQ25CLE9BQU9rQjtJQUNULEVBQUUsT0FBT3BCLE9BQU87UUFDZCxNQUFNYyxPQUFPWixLQUFLLENBQUM7UUFDbkIsTUFBTUY7SUFDUixTQUFVO1FBQ1JjLE9BQU9PLE9BQU87SUFDaEI7QUFDRjtBQUVBLDZCQUE2QjtBQUM3QixpRUFBZTtJQUNibkI7SUFDQVc7SUFDQUs7SUFDQTVCO0FBQ0YsQ0FBQyxFQUFDIiwic291cmNlcyI6WyIvVXNlcnMva2V2aW56dW5pZ2EvRGV2ZWxvcG1lbnQva2V2aW4vZmxvd2FwcC9tb25leS1mbG93L2xpYi9kYi5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQb29sIH0gZnJvbSAncGcnO1xuXG4vLyBDcmVhdGUgUG9zdGdyZVNRTCBjb25uZWN0aW9uIHBvb2xcbmNvbnN0IHBvb2wgPSBuZXcgUG9vbCh7XG4gIGNvbm5lY3Rpb25TdHJpbmc6IHByb2Nlc3MuZW52LkRBVEFCQVNFX1VSTCB8fCAncG9zdGdyZXNxbDovL3Bvc3RncmVzOnBhc3N3b3JkQGxvY2FsaG9zdDo1NDMyL21vbmV5X2Zsb3cnLFxuICBzc2w6IHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAncHJvZHVjdGlvbicgPyB7IHJlamVjdFVuYXV0aG9yaXplZDogZmFsc2UgfSA6IGZhbHNlXG59KTtcblxuLy8gTG9nIGRhdGFiYXNlIGNvbm5lY3Rpb24gZXJyb3JzXG5wb29sLm9uKCdlcnJvcicsIChlcnIpID0+IHtcbiAgY29uc29sZS5lcnJvcignVW5leHBlY3RlZCBlcnJvciBvbiBpZGxlIGNsaWVudCcsIGVycik7XG4gIHByb2Nlc3MuZXhpdCgtMSk7XG59KTtcblxuLy8gRXhlY3V0ZSBTUUwgcXVlcnkgd2l0aCBwYXJhbWV0ZXJzXG5jb25zdCBxdWVyeSA9IGFzeW5jICh0ZXh0LCBwYXJhbXMgPSBbXSkgPT4ge1xuICBjb25zdCBzdGFydCA9IERhdGUubm93KCk7XG4gIHRyeSB7XG4gICAgY29uc3QgcmVzID0gYXdhaXQgcG9vbC5xdWVyeSh0ZXh0LCBwYXJhbXMpO1xuICAgIGNvbnN0IGR1cmF0aW9uID0gRGF0ZS5ub3coKSAtIHN0YXJ0O1xuICAgIFxuICAgIC8vIExvZyBzbG93IHF1ZXJpZXMgKD4gMjAwbXMpIGZvciBkZWJ1Z2dpbmdcbiAgICBpZiAoZHVyYXRpb24gPiAyMDApIHtcbiAgICAgIGNvbnNvbGUubG9nKCdTbG93IHF1ZXJ5OicsIHsgdGV4dCwgZHVyYXRpb24sIHJvd3M6IHJlcy5yb3dDb3VudCB9KTtcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIHJlcztcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdEYXRhYmFzZSBxdWVyeSBlcnJvcjonLCBlcnJvcik7XG4gICAgXG4gICAgLy8gQWRkIG1vcmUgY29udGV4dCB0byB0aGUgZXJyb3IgZm9yIGRlYnVnZ2luZ1xuICAgIGVycm9yLnF1ZXJ5ID0gdGV4dDtcbiAgICBlcnJvci5wYXJhbXMgPSBwYXJhbXM7XG4gICAgXG4gICAgdGhyb3cgZXJyb3I7XG4gIH1cbn07XG5cbi8vIEdldCBhIGNsaWVudCBmcm9tIHRoZSBwb29sIGZvciB0cmFuc2FjdGlvbnNcbmNvbnN0IGdldENsaWVudCA9IGFzeW5jICgpID0+IHtcbiAgY29uc3QgY2xpZW50ID0gYXdhaXQgcG9vbC5jb25uZWN0KCk7XG4gIFxuICAvLyBNb25rZXkgcGF0Y2ggdGhlIHF1ZXJ5IG1ldGhvZCB0byBpbXBsZW1lbnQgdGhlIHNhbWUgbG9naWMgYXMgYWJvdmVcbiAgY29uc3Qgb3JpZ2luYWxRdWVyeSA9IGNsaWVudC5xdWVyeTtcbiAgY2xpZW50LnF1ZXJ5ID0gYXN5bmMgKHRleHQsIHBhcmFtcyA9IFtdKSA9PiB7XG4gICAgY29uc3Qgc3RhcnQgPSBEYXRlLm5vdygpO1xuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXMgPSBhd2FpdCBvcmlnaW5hbFF1ZXJ5LmNhbGwoY2xpZW50LCB0ZXh0LCBwYXJhbXMpO1xuICAgICAgY29uc3QgZHVyYXRpb24gPSBEYXRlLm5vdygpIC0gc3RhcnQ7XG4gICAgICBcbiAgICAgIGlmIChkdXJhdGlvbiA+IDIwMCkge1xuICAgICAgICBjb25zb2xlLmxvZygnU2xvdyBxdWVyeSBpbiB0cmFuc2FjdGlvbjonLCB7IHRleHQsIGR1cmF0aW9uLCByb3dzOiByZXMucm93Q291bnQgfSk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIHJldHVybiByZXM7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0RhdGFiYXNlIHRyYW5zYWN0aW9uIHF1ZXJ5IGVycm9yOicsIGVycm9yKTtcbiAgICAgIGVycm9yLnF1ZXJ5ID0gdGV4dDtcbiAgICAgIGVycm9yLnBhcmFtcyA9IHBhcmFtcztcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfTtcbiAgXG4gIHJldHVybiBjbGllbnQ7XG59O1xuXG4vLyBSdW4gYSBmdW5jdGlvbiB3aXRoaW4gYSB0cmFuc2FjdGlvblxuY29uc3QgdHJhbnNhY3Rpb24gPSBhc3luYyAoY2FsbGJhY2spID0+IHtcbiAgY29uc3QgY2xpZW50ID0gYXdhaXQgZ2V0Q2xpZW50KCk7XG4gIFxuICB0cnkge1xuICAgIGF3YWl0IGNsaWVudC5xdWVyeSgnQkVHSU4nKTtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjYWxsYmFjayhjbGllbnQpO1xuICAgIGF3YWl0IGNsaWVudC5xdWVyeSgnQ09NTUlUJyk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBhd2FpdCBjbGllbnQucXVlcnkoJ1JPTExCQUNLJyk7XG4gICAgdGhyb3cgZXJyb3I7XG4gIH0gZmluYWxseSB7XG4gICAgY2xpZW50LnJlbGVhc2UoKTtcbiAgfVxufTtcblxuLy8gRXhwb3J0IGRhdGFiYXNlIG9wZXJhdGlvbnNcbmV4cG9ydCBkZWZhdWx0IHtcbiAgcXVlcnksXG4gIGdldENsaWVudCxcbiAgdHJhbnNhY3Rpb24sXG4gIHBvb2xcbn07XG4iXSwibmFtZXMiOlsiUG9vbCIsInBvb2wiLCJjb25uZWN0aW9uU3RyaW5nIiwicHJvY2VzcyIsImVudiIsIkRBVEFCQVNFX1VSTCIsInNzbCIsInJlamVjdFVuYXV0aG9yaXplZCIsIm9uIiwiZXJyIiwiY29uc29sZSIsImVycm9yIiwiZXhpdCIsInF1ZXJ5IiwidGV4dCIsInBhcmFtcyIsInN0YXJ0IiwiRGF0ZSIsIm5vdyIsInJlcyIsImR1cmF0aW9uIiwibG9nIiwicm93cyIsInJvd0NvdW50IiwiZ2V0Q2xpZW50IiwiY2xpZW50IiwiY29ubmVjdCIsIm9yaWdpbmFsUXVlcnkiLCJjYWxsIiwidHJhbnNhY3Rpb24iLCJjYWxsYmFjayIsInJlc3VsdCIsInJlbGVhc2UiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api-node)/./lib/db.js\n");

/***/ }),

/***/ "(api-node)/./lib/middleware/auth.js":
/*!********************************!*\
  !*** ./lib/middleware/auth.js ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   authenticate: () => (/* binding */ authenticate),\n/* harmony export */   csrfProtection: () => (/* binding */ csrfProtection),\n/* harmony export */   extractToken: () => (/* binding */ extractToken),\n/* harmony export */   generateCsrfToken: () => (/* binding */ generateCsrfToken),\n/* harmony export */   rateLimiter: () => (/* binding */ rateLimiter),\n/* harmony export */   requireRoles: () => (/* binding */ requireRoles),\n/* harmony export */   secureRoute: () => (/* binding */ secureRoute),\n/* harmony export */   validateSession: () => (/* binding */ validateSession),\n/* harmony export */   verifyToken: () => (/* binding */ verifyToken)\n/* harmony export */ });\n/* harmony import */ var jsonwebtoken__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jsonwebtoken */ \"jsonwebtoken\");\n/* harmony import */ var jsonwebtoken__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jsonwebtoken__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var cookie__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! cookie */ \"cookie\");\n/* harmony import */ var cookie__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(cookie__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! crypto */ \"crypto\");\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(crypto__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _error__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./error */ \"(api-node)/./lib/middleware/error.js\");\n/**\n * Authentication Middleware\n * \n * This module provides authentication and authorization middleware\n * for securing API routes, including JWT validation, role-based\n * access control, and rate limiting.\n */ \n\n\n\n// In-memory cache for rate limiting (use Redis in production)\nconst rateLimit = {\n    requests: {},\n    tokens: {}\n};\n/**\n * Extract JWT token from request\n * \n * @param {Object} req - The request object\n * @returns {string|null} - JWT token or null if not found\n */ const extractToken = (req)=>{\n    // Check authorization header\n    const authHeader = req.headers.authorization;\n    if (authHeader && authHeader.startsWith('Bearer ')) {\n        return authHeader.substring(7);\n    }\n    // Check cookies\n    const cookies = cookie__WEBPACK_IMPORTED_MODULE_1___default().parse(req.headers.cookie || '');\n    if (cookies.token) {\n        return cookies.token;\n    }\n    return null;\n};\n/**\n * Verify and decode JWT token\n * \n * @param {string} token - JWT token to verify\n * @returns {Object} - Decoded token payload\n * @throws {UnauthorizedError} - If token is invalid\n */ const verifyToken = (token)=>{\n    try {\n        return jsonwebtoken__WEBPACK_IMPORTED_MODULE_0___default().verify(token, process.env.JWT_SECRET || 'your-secret-key');\n    } catch (error) {\n        throw new _error__WEBPACK_IMPORTED_MODULE_3__.UnauthorizedError('Token inválido o expirado');\n    }\n};\n/**\n * Authentication middleware - validates JWT token and adds user info to request\n * \n * @param {Object} req - The request object\n * @param {Object} res - The response object\n * @param {Function} next - The next middleware function\n * @returns {Promise<void>} - Calls next() if authentication is successful\n * @throws {UnauthorizedError} - If authentication fails\n */ const authenticate = async (req, res)=>{\n    try {\n        // Extract token\n        const token = extractToken(req);\n        if (!token) {\n            throw new _error__WEBPACK_IMPORTED_MODULE_3__.UnauthorizedError('No se proporcionó token de autenticación');\n        }\n        // Verify token\n        const decoded = verifyToken(token);\n        // Add user info to request\n        req.userId = decoded.userId;\n        req.userEmail = decoded.email;\n        req.userRoles = decoded.roles || [\n            'user'\n        ];\n        return decoded.userId;\n    } catch (error) {\n        // If error is already an UnauthorizedError, pass it through\n        if (error instanceof _error__WEBPACK_IMPORTED_MODULE_3__.UnauthorizedError) {\n            throw error;\n        }\n        // Otherwise, wrap it in an UnauthorizedError\n        throw new _error__WEBPACK_IMPORTED_MODULE_3__.UnauthorizedError('Autenticación fallida: ' + error.message);\n    }\n};\n/**\n * Role-based access control middleware\n * \n * @param {string|string[]} roles - Required role(s) for access\n * @returns {Function} - Middleware function\n */ const requireRoles = (roles)=>{\n    // Convert single role to array\n    const requiredRoles = Array.isArray(roles) ? roles : [\n        roles\n    ];\n    return async (req, res, next)=>{\n        try {\n            // First authenticate the user\n            await authenticate(req, res);\n            // Check if user has required role(s)\n            const hasRequiredRole = req.userRoles.some((role)=>requiredRoles.includes(role) || role === 'admin');\n            if (!hasRequiredRole) {\n                throw new _error__WEBPACK_IMPORTED_MODULE_3__.ForbiddenError('No tienes permisos para realizar esta acción');\n            }\n            // User has required role, proceed\n            next();\n        } catch (error) {\n            next(error);\n        }\n    };\n};\n/**\n * Rate limiting middleware to prevent abuse\n * \n * @param {Object} options - Rate limiting options\n * @param {number} options.maxRequests - Maximum requests per window (default: 100)\n * @param {number} options.windowMs - Time window in milliseconds (default: 60000)\n * @param {string} options.keyGenerator - Function to generate cache key (default: IP address)\n * @returns {Function} - Middleware function\n */ const rateLimiter = (options = {})=>{\n    const { maxRequests = 100, windowMs = 60 * 1000, keyGenerator = (req)=>req.ip || req.headers['x-forwarded-for'] || 'unknown' } = options;\n    return (req, res, next)=>{\n        try {\n            // Generate cache key\n            const key = keyGenerator(req);\n            // Initialize or get current requests count\n            if (!rateLimit.requests[key]) {\n                rateLimit.requests[key] = {\n                    count: 0,\n                    resetAt: Date.now() + windowMs\n                };\n                // Set timeout to reset count after window expires\n                setTimeout(()=>{\n                    delete rateLimit.requests[key];\n                }, windowMs);\n            }\n            // Check if over limit\n            if (rateLimit.requests[key].count >= maxRequests) {\n                // Calculate remaining time until reset\n                const resetIn = rateLimit.requests[key].resetAt - Date.now();\n                // Set rate limit headers\n                res.setHeader('X-RateLimit-Limit', maxRequests);\n                res.setHeader('X-RateLimit-Remaining', 0);\n                res.setHeader('X-RateLimit-Reset', Math.ceil(resetIn / 1000));\n                throw new _error__WEBPACK_IMPORTED_MODULE_3__.RateLimitError(`Demasiadas solicitudes. Intente de nuevo en ${Math.ceil(resetIn / 1000)} segundos.`);\n            }\n            // Increment request count\n            rateLimit.requests[key].count++;\n            // Set rate limit headers\n            res.setHeader('X-RateLimit-Limit', maxRequests);\n            res.setHeader('X-RateLimit-Remaining', Math.max(0, maxRequests - rateLimit.requests[key].count));\n            res.setHeader('X-RateLimit-Reset', Math.ceil((rateLimit.requests[key].resetAt - Date.now()) / 1000));\n            next();\n        } catch (error) {\n            next(error);\n        }\n    };\n};\n/**\n * CSRF protection middleware\n * \n * @param {Object} req - The request object\n * @param {Object} res - The response object\n * @param {Function} next - The next middleware function\n */ const csrfProtection = (req, res, next)=>{\n    // Skip CSRF check for GET, HEAD, OPTIONS requests\n    if ([\n        'GET',\n        'HEAD',\n        'OPTIONS'\n    ].includes(req.method)) {\n        return next();\n    }\n    try {\n        // Get CSRF token from header or form\n        const csrfToken = req.headers['x-csrf-token'] || req.body?._csrf;\n        // Get user's stored CSRF token from session/cookie\n        const cookies = cookie__WEBPACK_IMPORTED_MODULE_1___default().parse(req.headers.cookie || '');\n        const storedToken = cookies.csrfToken;\n        // Validate CSRF token\n        if (!csrfToken || !storedToken || csrfToken !== storedToken) {\n            throw new _error__WEBPACK_IMPORTED_MODULE_3__.ForbiddenError('CSRF token inválido o faltante');\n        }\n        next();\n    } catch (error) {\n        next(error);\n    }\n};\n/**\n * Generate a CSRF token for a user\n * \n * @param {Object} res - The response object\n * @returns {string} - Generated CSRF token\n */ const generateCsrfToken = (res)=>{\n    // Generate random token\n    const token = crypto__WEBPACK_IMPORTED_MODULE_2___default().randomBytes(32).toString('hex');\n    // Set CSRF cookie (HTTP-only: false so JS can read it)\n    res.setHeader('Set-Cookie', cookie__WEBPACK_IMPORTED_MODULE_1___default().serialize('csrfToken', token, {\n        httpOnly: false,\n        secure: \"development\" === 'production',\n        maxAge: 24 * 60 * 60,\n        path: '/',\n        sameSite: 'strict'\n    }));\n    return token;\n};\n/**\n * Session validation middleware\n * \n * @param {Object} req - The request object\n * @param {Object} res - The response object\n * @param {Function} next - The next middleware function\n */ const validateSession = async (req, res, next)=>{\n    try {\n        // Extract user ID from token\n        await authenticate(req, res);\n        // In a real app, you would check if session is valid in database\n        // For simplicity, we'll just check if the token exists\n        // Add session info to request\n        req.session = {\n            isValid: true,\n            userId: req.userId,\n            lastAccessed: new Date()\n        };\n        next();\n    } catch (error) {\n        next(error);\n    }\n};\n/**\n * Combined middleware that applies multiple security features\n * \n * @param {Object} options - Options for security features\n * @returns {Function[]} - Array of middleware functions\n */ const secureRoute = (options = {})=>{\n    const middleware = [];\n    // Apply rate limiting if enabled\n    if (options.rateLimit !== false) {\n        middleware.push(rateLimiter(options.rateLimit));\n    }\n    // Apply CSRF protection if enabled\n    if (options.csrf !== false) {\n        middleware.push(csrfProtection);\n    }\n    // Apply authentication middleware if enabled\n    if (options.auth !== false) {\n        middleware.push(validateSession);\n    }\n    // Apply role-based access control if roles are specified\n    if (options.roles) {\n        middleware.push(requireRoles(options.roles));\n    }\n    return middleware;\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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VUFBVTtJQUNaO0lBR0YsT0FBT3hEO0FBQ1QsRUFBRTtBQUVGOzs7Ozs7Q0FNQyxHQUNNLE1BQU15RCxrQkFBa0IsT0FBT2pFLEtBQUtnQixLQUFLWTtJQUM5QyxJQUFJO1FBQ0YsNkJBQTZCO1FBQzdCLE1BQU1iLGFBQWFmLEtBQUtnQjtRQUV4QixpRUFBaUU7UUFDakUsdURBQXVEO1FBRXZELDhCQUE4QjtRQUM5QmhCLElBQUlrRSxPQUFPLEdBQUc7WUFDWkMsU0FBUztZQUNUakQsUUFBUWxCLElBQUlrQixNQUFNO1lBQ2xCa0QsY0FBYyxJQUFJMUI7UUFDcEI7UUFFQWQ7SUFDRixFQUFFLE9BQU9kLE9BQU87UUFDZGMsS0FBS2Q7SUFDUDtBQUNGLEVBQUU7QUFFRjs7Ozs7Q0FLQyxHQUNNLE1BQU11RCxjQUFjLENBQUNuQyxVQUFVLENBQUMsQ0FBQztJQUN0QyxNQUFNb0MsYUFBYSxFQUFFO0lBRXJCLGlDQUFpQztJQUNqQyxJQUFJcEMsUUFBUXRDLFNBQVMsS0FBSyxPQUFPO1FBQy9CMEUsV0FBV0MsSUFBSSxDQUFDdEMsWUFBWUMsUUFBUXRDLFNBQVM7SUFDL0M7SUFFQSxtQ0FBbUM7SUFDbkMsSUFBSXNDLFFBQVFzQyxJQUFJLEtBQUssT0FBTztRQUMxQkYsV0FBV0MsSUFBSSxDQUFDckI7SUFDbEI7SUFFQSw2Q0FBNkM7SUFDN0MsSUFBSWhCLFFBQVF1QyxJQUFJLEtBQUssT0FBTztRQUMxQkgsV0FBV0MsSUFBSSxDQUFDTjtJQUNsQjtJQUVBLHlEQUF5RDtJQUN6RCxJQUFJL0IsUUFBUVosS0FBSyxFQUFFO1FBQ2pCZ0QsV0FBV0MsSUFBSSxDQUFDL0MsYUFBYVUsUUFBUVosS0FBSztJQUM1QztJQUVBLE9BQU9nRDtBQUNULEVBQUUiLCJzb3VyY2VzIjpbIi9Vc2Vycy9rZXZpbnp1bmlnYS9EZXZlbG9wbWVudC9rZXZpbi9mbG93YXBwL21vbmV5LWZsb3cvbGliL21pZGRsZXdhcmUvYXV0aC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEF1dGhlbnRpY2F0aW9uIE1pZGRsZXdhcmVcbiAqIFxuICogVGhpcyBtb2R1bGUgcHJvdmlkZXMgYXV0aGVudGljYXRpb24gYW5kIGF1dGhvcml6YXRpb24gbWlkZGxld2FyZVxuICogZm9yIHNlY3VyaW5nIEFQSSByb3V0ZXMsIGluY2x1ZGluZyBKV1QgdmFsaWRhdGlvbiwgcm9sZS1iYXNlZFxuICogYWNjZXNzIGNvbnRyb2wsIGFuZCByYXRlIGxpbWl0aW5nLlxuICovXG5cbmltcG9ydCBqd3QgZnJvbSAnanNvbndlYnRva2VuJztcbmltcG9ydCBjb29raWUgZnJvbSAnY29va2llJztcbmltcG9ydCBjcnlwdG8gZnJvbSAnY3J5cHRvJztcbmltcG9ydCB7IFVuYXV0aG9yaXplZEVycm9yLCBGb3JiaWRkZW5FcnJvciwgUmF0ZUxpbWl0RXJyb3IgfSBmcm9tICcuL2Vycm9yJztcblxuLy8gSW4tbWVtb3J5IGNhY2hlIGZvciByYXRlIGxpbWl0aW5nICh1c2UgUmVkaXMgaW4gcHJvZHVjdGlvbilcbmNvbnN0IHJhdGVMaW1pdCA9IHtcbiAgcmVxdWVzdHM6IHt9LFxuICB0b2tlbnM6IHt9XG59O1xuXG4vKipcbiAqIEV4dHJhY3QgSldUIHRva2VuIGZyb20gcmVxdWVzdFxuICogXG4gKiBAcGFyYW0ge09iamVjdH0gcmVxIC0gVGhlIHJlcXVlc3Qgb2JqZWN0XG4gKiBAcmV0dXJucyB7c3RyaW5nfG51bGx9IC0gSldUIHRva2VuIG9yIG51bGwgaWYgbm90IGZvdW5kXG4gKi9cbmV4cG9ydCBjb25zdCBleHRyYWN0VG9rZW4gPSAocmVxKSA9PiB7XG4gIC8vIENoZWNrIGF1dGhvcml6YXRpb24gaGVhZGVyXG4gIGNvbnN0IGF1dGhIZWFkZXIgPSByZXEuaGVhZGVycy5hdXRob3JpemF0aW9uO1xuICBpZiAoYXV0aEhlYWRlciAmJiBhdXRoSGVhZGVyLnN0YXJ0c1dpdGgoJ0JlYXJlciAnKSkge1xuICAgIHJldHVybiBhdXRoSGVhZGVyLnN1YnN0cmluZyg3KTtcbiAgfVxuICBcbiAgLy8gQ2hlY2sgY29va2llc1xuICBjb25zdCBjb29raWVzID0gY29va2llLnBhcnNlKHJlcS5oZWFkZXJzLmNvb2tpZSB8fCAnJyk7XG4gIGlmIChjb29raWVzLnRva2VuKSB7XG4gICAgcmV0dXJuIGNvb2tpZXMudG9rZW47XG4gIH1cbiAgXG4gIHJldHVybiBudWxsO1xufTtcblxuLyoqXG4gKiBWZXJpZnkgYW5kIGRlY29kZSBKV1QgdG9rZW5cbiAqIFxuICogQHBhcmFtIHtzdHJpbmd9IHRva2VuIC0gSldUIHRva2VuIHRvIHZlcmlmeVxuICogQHJldHVybnMge09iamVjdH0gLSBEZWNvZGVkIHRva2VuIHBheWxvYWRcbiAqIEB0aHJvd3Mge1VuYXV0aG9yaXplZEVycm9yfSAtIElmIHRva2VuIGlzIGludmFsaWRcbiAqL1xuZXhwb3J0IGNvbnN0IHZlcmlmeVRva2VuID0gKHRva2VuKSA9PiB7XG4gIHRyeSB7XG4gICAgcmV0dXJuIGp3dC52ZXJpZnkodG9rZW4sIHByb2Nlc3MuZW52LkpXVF9TRUNSRVQgfHwgJ3lvdXItc2VjcmV0LWtleScpO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIHRocm93IG5ldyBVbmF1dGhvcml6ZWRFcnJvcignVG9rZW4gaW52w6FsaWRvIG8gZXhwaXJhZG8nKTtcbiAgfVxufTtcblxuLyoqXG4gKiBBdXRoZW50aWNhdGlvbiBtaWRkbGV3YXJlIC0gdmFsaWRhdGVzIEpXVCB0b2tlbiBhbmQgYWRkcyB1c2VyIGluZm8gdG8gcmVxdWVzdFxuICogXG4gKiBAcGFyYW0ge09iamVjdH0gcmVxIC0gVGhlIHJlcXVlc3Qgb2JqZWN0XG4gKiBAcGFyYW0ge09iamVjdH0gcmVzIC0gVGhlIHJlc3BvbnNlIG9iamVjdFxuICogQHBhcmFtIHtGdW5jdGlvbn0gbmV4dCAtIFRoZSBuZXh0IG1pZGRsZXdhcmUgZnVuY3Rpb25cbiAqIEByZXR1cm5zIHtQcm9taXNlPHZvaWQ+fSAtIENhbGxzIG5leHQoKSBpZiBhdXRoZW50aWNhdGlvbiBpcyBzdWNjZXNzZnVsXG4gKiBAdGhyb3dzIHtVbmF1dGhvcml6ZWRFcnJvcn0gLSBJZiBhdXRoZW50aWNhdGlvbiBmYWlsc1xuICovXG5leHBvcnQgY29uc3QgYXV0aGVudGljYXRlID0gYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gIHRyeSB7XG4gICAgLy8gRXh0cmFjdCB0b2tlblxuICAgIGNvbnN0IHRva2VuID0gZXh0cmFjdFRva2VuKHJlcSk7XG4gICAgXG4gICAgaWYgKCF0b2tlbikge1xuICAgICAgdGhyb3cgbmV3IFVuYXV0aG9yaXplZEVycm9yKCdObyBzZSBwcm9wb3JjaW9uw7MgdG9rZW4gZGUgYXV0ZW50aWNhY2nDs24nKTtcbiAgICB9XG4gICAgXG4gICAgLy8gVmVyaWZ5IHRva2VuXG4gICAgY29uc3QgZGVjb2RlZCA9IHZlcmlmeVRva2VuKHRva2VuKTtcbiAgICBcbiAgICAvLyBBZGQgdXNlciBpbmZvIHRvIHJlcXVlc3RcbiAgICByZXEudXNlcklkID0gZGVjb2RlZC51c2VySWQ7XG4gICAgcmVxLnVzZXJFbWFpbCA9IGRlY29kZWQuZW1haWw7XG4gICAgcmVxLnVzZXJSb2xlcyA9IGRlY29kZWQucm9sZXMgfHwgWyd1c2VyJ107XG4gICAgXG4gICAgcmV0dXJuIGRlY29kZWQudXNlcklkO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIC8vIElmIGVycm9yIGlzIGFscmVhZHkgYW4gVW5hdXRob3JpemVkRXJyb3IsIHBhc3MgaXQgdGhyb3VnaFxuICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIFVuYXV0aG9yaXplZEVycm9yKSB7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gICAgXG4gICAgLy8gT3RoZXJ3aXNlLCB3cmFwIGl0IGluIGFuIFVuYXV0aG9yaXplZEVycm9yXG4gICAgdGhyb3cgbmV3IFVuYXV0aG9yaXplZEVycm9yKCdBdXRlbnRpY2FjacOzbiBmYWxsaWRhOiAnICsgZXJyb3IubWVzc2FnZSk7XG4gIH1cbn07XG5cbi8qKlxuICogUm9sZS1iYXNlZCBhY2Nlc3MgY29udHJvbCBtaWRkbGV3YXJlXG4gKiBcbiAqIEBwYXJhbSB7c3RyaW5nfHN0cmluZ1tdfSByb2xlcyAtIFJlcXVpcmVkIHJvbGUocykgZm9yIGFjY2Vzc1xuICogQHJldHVybnMge0Z1bmN0aW9ufSAtIE1pZGRsZXdhcmUgZnVuY3Rpb25cbiAqL1xuZXhwb3J0IGNvbnN0IHJlcXVpcmVSb2xlcyA9IChyb2xlcykgPT4ge1xuICAvLyBDb252ZXJ0IHNpbmdsZSByb2xlIHRvIGFycmF5XG4gIGNvbnN0IHJlcXVpcmVkUm9sZXMgPSBBcnJheS5pc0FycmF5KHJvbGVzKSA/IHJvbGVzIDogW3JvbGVzXTtcbiAgXG4gIHJldHVybiBhc3luYyAocmVxLCByZXMsIG5leHQpID0+IHtcbiAgICB0cnkge1xuICAgICAgLy8gRmlyc3QgYXV0aGVudGljYXRlIHRoZSB1c2VyXG4gICAgICBhd2FpdCBhdXRoZW50aWNhdGUocmVxLCByZXMpO1xuICAgICAgXG4gICAgICAvLyBDaGVjayBpZiB1c2VyIGhhcyByZXF1aXJlZCByb2xlKHMpXG4gICAgICBjb25zdCBoYXNSZXF1aXJlZFJvbGUgPSByZXEudXNlclJvbGVzLnNvbWUocm9sZSA9PiBcbiAgICAgICAgcmVxdWlyZWRSb2xlcy5pbmNsdWRlcyhyb2xlKSB8fCByb2xlID09PSAnYWRtaW4nXG4gICAgICApO1xuICAgICAgXG4gICAgICBpZiAoIWhhc1JlcXVpcmVkUm9sZSkge1xuICAgICAgICB0aHJvdyBuZXcgRm9yYmlkZGVuRXJyb3IoJ05vIHRpZW5lcyBwZXJtaXNvcyBwYXJhIHJlYWxpemFyIGVzdGEgYWNjacOzbicpO1xuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBVc2VyIGhhcyByZXF1aXJlZCByb2xlLCBwcm9jZWVkXG4gICAgICBuZXh0KCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIG5leHQoZXJyb3IpO1xuICAgIH1cbiAgfTtcbn07XG5cbi8qKlxuICogUmF0ZSBsaW1pdGluZyBtaWRkbGV3YXJlIHRvIHByZXZlbnQgYWJ1c2VcbiAqIFxuICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMgLSBSYXRlIGxpbWl0aW5nIG9wdGlvbnNcbiAqIEBwYXJhbSB7bnVtYmVyfSBvcHRpb25zLm1heFJlcXVlc3RzIC0gTWF4aW11bSByZXF1ZXN0cyBwZXIgd2luZG93IChkZWZhdWx0OiAxMDApXG4gKiBAcGFyYW0ge251bWJlcn0gb3B0aW9ucy53aW5kb3dNcyAtIFRpbWUgd2luZG93IGluIG1pbGxpc2Vjb25kcyAoZGVmYXVsdDogNjAwMDApXG4gKiBAcGFyYW0ge3N0cmluZ30gb3B0aW9ucy5rZXlHZW5lcmF0b3IgLSBGdW5jdGlvbiB0byBnZW5lcmF0ZSBjYWNoZSBrZXkgKGRlZmF1bHQ6IElQIGFkZHJlc3MpXG4gKiBAcmV0dXJucyB7RnVuY3Rpb259IC0gTWlkZGxld2FyZSBmdW5jdGlvblxuICovXG5leHBvcnQgY29uc3QgcmF0ZUxpbWl0ZXIgPSAob3B0aW9ucyA9IHt9KSA9PiB7XG4gIGNvbnN0IHtcbiAgICBtYXhSZXF1ZXN0cyA9IDEwMCxcbiAgICB3aW5kb3dNcyA9IDYwICogMTAwMCwgLy8gMSBtaW51dGVcbiAgICBrZXlHZW5lcmF0b3IgPSAocmVxKSA9PiByZXEuaXAgfHwgcmVxLmhlYWRlcnNbJ3gtZm9yd2FyZGVkLWZvciddIHx8ICd1bmtub3duJ1xuICB9ID0gb3B0aW9ucztcbiAgXG4gIHJldHVybiAocmVxLCByZXMsIG5leHQpID0+IHtcbiAgICB0cnkge1xuICAgICAgLy8gR2VuZXJhdGUgY2FjaGUga2V5XG4gICAgICBjb25zdCBrZXkgPSBrZXlHZW5lcmF0b3IocmVxKTtcbiAgICAgIFxuICAgICAgLy8gSW5pdGlhbGl6ZSBvciBnZXQgY3VycmVudCByZXF1ZXN0cyBjb3VudFxuICAgICAgaWYgKCFyYXRlTGltaXQucmVxdWVzdHNba2V5XSkge1xuICAgICAgICByYXRlTGltaXQucmVxdWVzdHNba2V5XSA9IHtcbiAgICAgICAgICBjb3VudDogMCxcbiAgICAgICAgICByZXNldEF0OiBEYXRlLm5vdygpICsgd2luZG93TXNcbiAgICAgICAgfTtcbiAgICAgICAgXG4gICAgICAgIC8vIFNldCB0aW1lb3V0IHRvIHJlc2V0IGNvdW50IGFmdGVyIHdpbmRvdyBleHBpcmVzXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgIGRlbGV0ZSByYXRlTGltaXQucmVxdWVzdHNba2V5XTtcbiAgICAgICAgfSwgd2luZG93TXMpO1xuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBDaGVjayBpZiBvdmVyIGxpbWl0XG4gICAgICBpZiAocmF0ZUxpbWl0LnJlcXVlc3RzW2tleV0uY291bnQgPj0gbWF4UmVxdWVzdHMpIHtcbiAgICAgICAgLy8gQ2FsY3VsYXRlIHJlbWFpbmluZyB0aW1lIHVudGlsIHJlc2V0XG4gICAgICAgIGNvbnN0IHJlc2V0SW4gPSByYXRlTGltaXQucmVxdWVzdHNba2V5XS5yZXNldEF0IC0gRGF0ZS5ub3coKTtcbiAgICAgICAgXG4gICAgICAgIC8vIFNldCByYXRlIGxpbWl0IGhlYWRlcnNcbiAgICAgICAgcmVzLnNldEhlYWRlcignWC1SYXRlTGltaXQtTGltaXQnLCBtYXhSZXF1ZXN0cyk7XG4gICAgICAgIHJlcy5zZXRIZWFkZXIoJ1gtUmF0ZUxpbWl0LVJlbWFpbmluZycsIDApO1xuICAgICAgICByZXMuc2V0SGVhZGVyKCdYLVJhdGVMaW1pdC1SZXNldCcsIE1hdGguY2VpbChyZXNldEluIC8gMTAwMCkpO1xuICAgICAgICBcbiAgICAgICAgdGhyb3cgbmV3IFJhdGVMaW1pdEVycm9yKFxuICAgICAgICAgIGBEZW1hc2lhZGFzIHNvbGljaXR1ZGVzLiBJbnRlbnRlIGRlIG51ZXZvIGVuICR7TWF0aC5jZWlsKHJlc2V0SW4gLyAxMDAwKX0gc2VndW5kb3MuYFxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBJbmNyZW1lbnQgcmVxdWVzdCBjb3VudFxuICAgICAgcmF0ZUxpbWl0LnJlcXVlc3RzW2tleV0uY291bnQrKztcbiAgICAgIFxuICAgICAgLy8gU2V0IHJhdGUgbGltaXQgaGVhZGVyc1xuICAgICAgcmVzLnNldEhlYWRlcignWC1SYXRlTGltaXQtTGltaXQnLCBtYXhSZXF1ZXN0cyk7XG4gICAgICByZXMuc2V0SGVhZGVyKFxuICAgICAgICAnWC1SYXRlTGltaXQtUmVtYWluaW5nJywgXG4gICAgICAgIE1hdGgubWF4KDAsIG1heFJlcXVlc3RzIC0gcmF0ZUxpbWl0LnJlcXVlc3RzW2tleV0uY291bnQpXG4gICAgICApO1xuICAgICAgcmVzLnNldEhlYWRlcihcbiAgICAgICAgJ1gtUmF0ZUxpbWl0LVJlc2V0JywgXG4gICAgICAgIE1hdGguY2VpbCgocmF0ZUxpbWl0LnJlcXVlc3RzW2tleV0ucmVzZXRBdCAtIERhdGUubm93KCkpIC8gMTAwMClcbiAgICAgICk7XG4gICAgICBcbiAgICAgIG5leHQoKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbmV4dChlcnJvcik7XG4gICAgfVxuICB9O1xufTtcblxuLyoqXG4gKiBDU1JGIHByb3RlY3Rpb24gbWlkZGxld2FyZVxuICogXG4gKiBAcGFyYW0ge09iamVjdH0gcmVxIC0gVGhlIHJlcXVlc3Qgb2JqZWN0XG4gKiBAcGFyYW0ge09iamVjdH0gcmVzIC0gVGhlIHJlc3BvbnNlIG9iamVjdFxuICogQHBhcmFtIHtGdW5jdGlvbn0gbmV4dCAtIFRoZSBuZXh0IG1pZGRsZXdhcmUgZnVuY3Rpb25cbiAqL1xuZXhwb3J0IGNvbnN0IGNzcmZQcm90ZWN0aW9uID0gKHJlcSwgcmVzLCBuZXh0KSA9PiB7XG4gIC8vIFNraXAgQ1NSRiBjaGVjayBmb3IgR0VULCBIRUFELCBPUFRJT05TIHJlcXVlc3RzXG4gIGlmIChbJ0dFVCcsICdIRUFEJywgJ09QVElPTlMnXS5pbmNsdWRlcyhyZXEubWV0aG9kKSkge1xuICAgIHJldHVybiBuZXh0KCk7XG4gIH1cbiAgXG4gIHRyeSB7XG4gICAgLy8gR2V0IENTUkYgdG9rZW4gZnJvbSBoZWFkZXIgb3IgZm9ybVxuICAgIGNvbnN0IGNzcmZUb2tlbiA9IHJlcS5oZWFkZXJzWyd4LWNzcmYtdG9rZW4nXSB8fCByZXEuYm9keT8uX2NzcmY7XG4gICAgXG4gICAgLy8gR2V0IHVzZXIncyBzdG9yZWQgQ1NSRiB0b2tlbiBmcm9tIHNlc3Npb24vY29va2llXG4gICAgY29uc3QgY29va2llcyA9IGNvb2tpZS5wYXJzZShyZXEuaGVhZGVycy5jb29raWUgfHwgJycpO1xuICAgIGNvbnN0IHN0b3JlZFRva2VuID0gY29va2llcy5jc3JmVG9rZW47XG4gICAgXG4gICAgLy8gVmFsaWRhdGUgQ1NSRiB0b2tlblxuICAgIGlmICghY3NyZlRva2VuIHx8ICFzdG9yZWRUb2tlbiB8fCBjc3JmVG9rZW4gIT09IHN0b3JlZFRva2VuKSB7XG4gICAgICB0aHJvdyBuZXcgRm9yYmlkZGVuRXJyb3IoJ0NTUkYgdG9rZW4gaW52w6FsaWRvIG8gZmFsdGFudGUnKTtcbiAgICB9XG4gICAgXG4gICAgbmV4dCgpO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIG5leHQoZXJyb3IpO1xuICB9XG59O1xuXG4vKipcbiAqIEdlbmVyYXRlIGEgQ1NSRiB0b2tlbiBmb3IgYSB1c2VyXG4gKiBcbiAqIEBwYXJhbSB7T2JqZWN0fSByZXMgLSBUaGUgcmVzcG9uc2Ugb2JqZWN0XG4gKiBAcmV0dXJucyB7c3RyaW5nfSAtIEdlbmVyYXRlZCBDU1JGIHRva2VuXG4gKi9cbmV4cG9ydCBjb25zdCBnZW5lcmF0ZUNzcmZUb2tlbiA9IChyZXMpID0+IHtcbiAgLy8gR2VuZXJhdGUgcmFuZG9tIHRva2VuXG4gIGNvbnN0IHRva2VuID0gY3J5cHRvLnJhbmRvbUJ5dGVzKDMyKS50b1N0cmluZygnaGV4Jyk7XG4gIFxuICAvLyBTZXQgQ1NSRiBjb29raWUgKEhUVFAtb25seTogZmFsc2Ugc28gSlMgY2FuIHJlYWQgaXQpXG4gIHJlcy5zZXRIZWFkZXIoXG4gICAgJ1NldC1Db29raWUnLFxuICAgIGNvb2tpZS5zZXJpYWxpemUoJ2NzcmZUb2tlbicsIHRva2VuLCB7XG4gICAgICBodHRwT25seTogZmFsc2UsXG4gICAgICBzZWN1cmU6IHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAncHJvZHVjdGlvbicsXG4gICAgICBtYXhBZ2U6IDI0ICogNjAgKiA2MCwgLy8gMjQgaG91cnNcbiAgICAgIHBhdGg6ICcvJyxcbiAgICAgIHNhbWVTaXRlOiAnc3RyaWN0JyxcbiAgICB9KVxuICApO1xuICBcbiAgcmV0dXJuIHRva2VuO1xufTtcblxuLyoqXG4gKiBTZXNzaW9uIHZhbGlkYXRpb24gbWlkZGxld2FyZVxuICogXG4gKiBAcGFyYW0ge09iamVjdH0gcmVxIC0gVGhlIHJlcXVlc3Qgb2JqZWN0XG4gKiBAcGFyYW0ge09iamVjdH0gcmVzIC0gVGhlIHJlc3BvbnNlIG9iamVjdFxuICogQHBhcmFtIHtGdW5jdGlvbn0gbmV4dCAtIFRoZSBuZXh0IG1pZGRsZXdhcmUgZnVuY3Rpb25cbiAqL1xuZXhwb3J0IGNvbnN0IHZhbGlkYXRlU2Vzc2lvbiA9IGFzeW5jIChyZXEsIHJlcywgbmV4dCkgPT4ge1xuICB0cnkge1xuICAgIC8vIEV4dHJhY3QgdXNlciBJRCBmcm9tIHRva2VuXG4gICAgYXdhaXQgYXV0aGVudGljYXRlKHJlcSwgcmVzKTtcbiAgICBcbiAgICAvLyBJbiBhIHJlYWwgYXBwLCB5b3Ugd291bGQgY2hlY2sgaWYgc2Vzc2lvbiBpcyB2YWxpZCBpbiBkYXRhYmFzZVxuICAgIC8vIEZvciBzaW1wbGljaXR5LCB3ZSdsbCBqdXN0IGNoZWNrIGlmIHRoZSB0b2tlbiBleGlzdHNcbiAgICBcbiAgICAvLyBBZGQgc2Vzc2lvbiBpbmZvIHRvIHJlcXVlc3RcbiAgICByZXEuc2Vzc2lvbiA9IHtcbiAgICAgIGlzVmFsaWQ6IHRydWUsXG4gICAgICB1c2VySWQ6IHJlcS51c2VySWQsXG4gICAgICBsYXN0QWNjZXNzZWQ6IG5ldyBEYXRlKClcbiAgICB9O1xuICAgIFxuICAgIG5leHQoKTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBuZXh0KGVycm9yKTtcbiAgfVxufTtcblxuLyoqXG4gKiBDb21iaW5lZCBtaWRkbGV3YXJlIHRoYXQgYXBwbGllcyBtdWx0aXBsZSBzZWN1cml0eSBmZWF0dXJlc1xuICogXG4gKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucyAtIE9wdGlvbnMgZm9yIHNlY3VyaXR5IGZlYXR1cmVzXG4gKiBAcmV0dXJucyB7RnVuY3Rpb25bXX0gLSBBcnJheSBvZiBtaWRkbGV3YXJlIGZ1bmN0aW9uc1xuICovXG5leHBvcnQgY29uc3Qgc2VjdXJlUm91dGUgPSAob3B0aW9ucyA9IHt9KSA9PiB7XG4gIGNvbnN0IG1pZGRsZXdhcmUgPSBbXTtcbiAgXG4gIC8vIEFwcGx5IHJhdGUgbGltaXRpbmcgaWYgZW5hYmxlZFxuICBpZiAob3B0aW9ucy5yYXRlTGltaXQgIT09IGZhbHNlKSB7XG4gICAgbWlkZGxld2FyZS5wdXNoKHJhdGVMaW1pdGVyKG9wdGlvbnMucmF0ZUxpbWl0KSk7XG4gIH1cbiAgXG4gIC8vIEFwcGx5IENTUkYgcHJvdGVjdGlvbiBpZiBlbmFibGVkXG4gIGlmIChvcHRpb25zLmNzcmYgIT09IGZhbHNlKSB7XG4gICAgbWlkZGxld2FyZS5wdXNoKGNzcmZQcm90ZWN0aW9uKTtcbiAgfVxuICBcbiAgLy8gQXBwbHkgYXV0aGVudGljYXRpb24gbWlkZGxld2FyZSBpZiBlbmFibGVkXG4gIGlmIChvcHRpb25zLmF1dGggIT09IGZhbHNlKSB7XG4gICAgbWlkZGxld2FyZS5wdXNoKHZhbGlkYXRlU2Vzc2lvbik7XG4gIH1cbiAgXG4gIC8vIEFwcGx5IHJvbGUtYmFzZWQgYWNjZXNzIGNvbnRyb2wgaWYgcm9sZXMgYXJlIHNwZWNpZmllZFxuICBpZiAob3B0aW9ucy5yb2xlcykge1xuICAgIG1pZGRsZXdhcmUucHVzaChyZXF1aXJlUm9sZXMob3B0aW9ucy5yb2xlcykpO1xuICB9XG4gIFxuICByZXR1cm4gbWlkZGxld2FyZTtcbn07XG5cbiJdLCJuYW1lcyI6WyJqd3QiLCJjb29raWUiLCJjcnlwdG8iLCJVbmF1dGhvcml6ZWRFcnJvciIsIkZvcmJpZGRlbkVycm9yIiwiUmF0ZUxpbWl0RXJyb3IiLCJyYXRlTGltaXQiLCJyZXF1ZXN0cyIsInRva2VucyIsImV4dHJhY3RUb2tlbiIsInJlcSIsImF1dGhIZWFkZXIiLCJoZWFkZXJzIiwiYXV0aG9yaXphdGlvbiIsInN0YXJ0c1dpdGgiLCJzdWJzdHJpbmciLCJjb29raWVzIiwicGFyc2UiLCJ0b2tlbiIsInZlcmlmeVRva2VuIiwidmVyaWZ5IiwicHJvY2VzcyIsImVudiIsIkpXVF9TRUNSRVQiLCJlcnJvciIsImF1dGhlbnRpY2F0ZSIsInJlcyIsImRlY29kZWQiLCJ1c2VySWQiLCJ1c2VyRW1haWwiLCJlbWFpbCIsInVzZXJSb2xlcyIsInJvbGVzIiwibWVzc2FnZSIsInJlcXVpcmVSb2xlcyIsInJlcXVpcmVkUm9sZXMiLCJBcnJheSIsImlzQXJyYXkiLCJuZXh0IiwiaGFzUmVxdWlyZWRSb2xlIiwic29tZSIsInJvbGUiLCJpbmNsdWRlcyIsInJhdGVMaW1pdGVyIiwib3B0aW9ucyIsIm1heFJlcXVlc3RzIiwid2luZG93TXMiLCJrZXlHZW5lcmF0b3IiLCJpcCIsImtleSIsImNvdW50IiwicmVzZXRBdCIsIkRhdGUiLCJub3ciLCJzZXRUaW1lb3V0IiwicmVzZXRJbiIsInNldEhlYWRlciIsIk1hdGgiLCJjZWlsIiwibWF4IiwiY3NyZlByb3RlY3Rpb24iLCJtZXRob2QiLCJjc3JmVG9rZW4iLCJib2R5IiwiX2NzcmYiLCJzdG9yZWRUb2tlbiIsImdlbmVyYXRlQ3NyZlRva2VuIiwicmFuZG9tQnl0ZXMiLCJ0b1N0cmluZyIsInNlcmlhbGl6ZSIsImh0dHBPbmx5Iiwic2VjdXJlIiwibWF4QWdlIiwicGF0aCIsInNhbWVTaXRlIiwidmFsaWRhdGVTZXNzaW9uIiwic2Vzc2lvbiIsImlzVmFsaWQiLCJsYXN0QWNjZXNzZWQiLCJzZWN1cmVSb3V0ZSIsIm1pZGRsZXdhcmUiLCJwdXNoIiwiY3NyZiIsImF1dGgiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api-node)/./lib/middleware/auth.js\n");

/***/ }),

/***/ "(api-node)/./lib/middleware/error.js":
/*!*********************************!*\
  !*** ./lib/middleware/error.js ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ApiError: () => (/* binding */ ApiError),\n/* harmony export */   BadRequestError: () => (/* binding */ BadRequestError),\n/* harmony export */   ForbiddenError: () => (/* binding */ ForbiddenError),\n/* harmony export */   InternalServerError: () => (/* binding */ InternalServerError),\n/* harmony export */   NotFoundError: () => (/* binding */ NotFoundError),\n/* harmony export */   RateLimitError: () => (/* binding */ RateLimitError),\n/* harmony export */   UnauthorizedError: () => (/* binding */ UnauthorizedError),\n/* harmony export */   ValidationError: () => (/* binding */ ValidationError),\n/* harmony export */   formatErrorResponse: () => (/* binding */ formatErrorResponse),\n/* harmony export */   handleApiError: () => (/* binding */ handleApiError),\n/* harmony export */   logError: () => (/* binding */ logError),\n/* harmony export */   withErrorHandling: () => (/* binding */ withErrorHandling)\n/* harmony export */ });\n/**\n * Error handling middleware and custom error classes\n * \n * This module provides centralized error handling for the API,\n * including custom error classes and error formatting.\n */ /**\n * Base API Error class that extends Error with additional properties\n */ class ApiError extends Error {\n    constructor(message, statusCode, errors = null){\n        super(message);\n        this.statusCode = statusCode;\n        this.errors = errors;\n        this.name = this.constructor.name;\n        Error.captureStackTrace(this, this.constructor);\n    }\n}\n/**\n * 400 Bad Request - Used for invalid input, missing required parameters, etc.\n */ class BadRequestError extends ApiError {\n    constructor(message = 'Bad Request', errors = null){\n        super(message, 400, errors);\n    }\n}\n/**\n * 401 Unauthorized - Used for authentication failures\n */ class UnauthorizedError extends ApiError {\n    constructor(message = 'No autorizado', errors = null){\n        super(message, 401, errors);\n    }\n}\n/**\n * 403 Forbidden - Used for authorization failures (authenticated but not allowed)\n */ class ForbiddenError extends ApiError {\n    constructor(message = 'Acceso prohibido', errors = null){\n        super(message, 403, errors);\n    }\n}\n/**\n * 404 Not Found - Used when resource is not found\n */ class NotFoundError extends ApiError {\n    constructor(message = 'Recurso no encontrado', errors = null){\n        super(message, 404, errors);\n    }\n}\n/**\n * 422 Unprocessable Entity - Used for validation errors\n */ class ValidationError extends ApiError {\n    constructor(message = 'Error de validación', errors = null){\n        super(message, 422, errors);\n    }\n}\n/**\n * 429 Too Many Requests - Used for rate limiting\n */ class RateLimitError extends ApiError {\n    constructor(message = 'Demasiadas solicitudes', errors = null){\n        super(message, 429, errors);\n    }\n}\n/**\n * 500 Internal Server Error - Used for server errors\n */ class InternalServerError extends ApiError {\n    constructor(message = 'Error interno del servidor', errors = null){\n        super(message, 500, errors);\n    }\n}\n/**\n * Log an error with contextual information\n * \n * @param {Error} error - The error to log\n * @param {Object} req - The request object\n */ const logError = (error, req = null)=>{\n    const timestamp = new Date().toISOString();\n    const errorType = error.name || 'Error';\n    const path = req ? `${req.method} ${req.url}` : 'Unknown path';\n    const userId = req && req.userId ? req.userId : 'Unauthenticated';\n    // Basic error information for the log\n    const logData = {\n        timestamp,\n        errorType,\n        message: error.message,\n        path,\n        userId,\n        statusCode: error.statusCode || 500\n    };\n    // Add stack trace in development\n    if (true) {\n        logData.stack = error.stack;\n    }\n    // Add validation errors if available\n    if (error.errors) {\n        logData.validationErrors = error.errors;\n    }\n    // Log the error\n    console.error('API ERROR:', logData);\n};\n/**\n * Format an error response to be sent to the client\n * \n * @param {Error} error - The error to format\n * @param {boolean} includeDetails - Whether to include error details (for development)\n * @returns {Object} - Formatted error response\n */ const formatErrorResponse = (error, includeDetails = false)=>{\n    // Default error response\n    const errorResponse = {\n        success: false,\n        message: error.message || 'An unexpected error occurred',\n        statusCode: error.statusCode || 500\n    };\n    // Include validation errors if available\n    if (error.errors) {\n        errorResponse.errors = error.errors;\n    }\n    // Include error details in development\n    if (includeDetails && \"development\" !== 'production') {\n        errorResponse.stack = error.stack;\n        errorResponse.name = error.name;\n    }\n    return errorResponse;\n};\n/**\n * Error handling middleware for API routes\n * \n * @param {Error} error - The error that occurred\n * @param {Object} req - The request object\n * @param {Object} res - The response object\n * @returns {Object} - Error response\n */ const handleApiError = (error, req, res)=>{\n    // Log the error\n    logError(error, req);\n    // Determine error status code (default to 500)\n    const statusCode = error.statusCode || 500;\n    // Format error response including details in non-production environments\n    const errorResponse = formatErrorResponse(error, \"development\" !== 'production');\n    // Send error response\n    return res.status(statusCode).json(errorResponse);\n};\n/**\n * Middleware to handle specific types of errors in API routes\n * \n * @param {Function} handler - The API route handler\n * @returns {Function} - Enhanced handler with error handling\n */ const withErrorHandling = (handler)=>{\n    return async (req, res)=>{\n        try {\n            return await handler(req, res);\n        } catch (error) {\n            return handleApiError(error, req, res);\n        }\n    };\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFpQixLQUFLO0lBQy9ELHlCQUF5QjtJQUN6QixNQUFNQyxnQkFBZ0I7UUFDcEJDLFNBQVM7UUFDVC9CLFNBQVNhLE1BQU1iLE9BQU8sSUFBSTtRQUMxQkMsWUFBWVksTUFBTVosVUFBVSxJQUFJO0lBQ2xDO0lBRUEseUNBQXlDO0lBQ3pDLElBQUlZLE1BQU1YLE1BQU0sRUFBRTtRQUNoQjRCLGNBQWM1QixNQUFNLEdBQUdXLE1BQU1YLE1BQU07SUFDckM7SUFFQSx1Q0FBdUM7SUFDdkMsSUFBSTJCLGtCQUFrQkwsa0JBQXlCLGNBQWM7UUFDM0RNLGNBQWNMLEtBQUssR0FBR1osTUFBTVksS0FBSztRQUNqQ0ssY0FBYzNCLElBQUksR0FBR1UsTUFBTVYsSUFBSTtJQUNqQztJQUVBLE9BQU8yQjtBQUNULEVBQUU7QUFFRjs7Ozs7OztDQU9DLEdBQ00sTUFBTUUsaUJBQWlCLENBQUNuQixPQUFPQyxLQUFLbUI7SUFDekMsZ0JBQWdCO0lBQ2hCckIsU0FBU0MsT0FBT0M7SUFFaEIsK0NBQStDO0lBQy9DLE1BQU1iLGFBQWFZLE1BQU1aLFVBQVUsSUFBSTtJQUV2Qyx5RUFBeUU7SUFDekUsTUFBTTZCLGdCQUFnQkYsb0JBQ3BCZixPQUNBVyxrQkFBeUI7SUFHM0Isc0JBQXNCO0lBQ3RCLE9BQU9TLElBQUlDLE1BQU0sQ0FBQ2pDLFlBQVlrQyxJQUFJLENBQUNMO0FBQ3JDLEVBQUU7QUFFRjs7Ozs7Q0FLQyxHQUNNLE1BQU1NLG9CQUFvQixDQUFDQztJQUNoQyxPQUFPLE9BQU92QixLQUFLbUI7UUFDakIsSUFBSTtZQUNGLE9BQU8sTUFBTUksUUFBUXZCLEtBQUttQjtRQUM1QixFQUFFLE9BQU9wQixPQUFPO1lBQ2QsT0FBT21CLGVBQWVuQixPQUFPQyxLQUFLbUI7UUFDcEM7SUFDRjtBQUNGLEVBQUUiLCJzb3VyY2VzIjpbIi9Vc2Vycy9rZXZpbnp1bmlnYS9EZXZlbG9wbWVudC9rZXZpbi9mbG93YXBwL21vbmV5LWZsb3cvbGliL21pZGRsZXdhcmUvZXJyb3IuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBFcnJvciBoYW5kbGluZyBtaWRkbGV3YXJlIGFuZCBjdXN0b20gZXJyb3IgY2xhc3Nlc1xuICogXG4gKiBUaGlzIG1vZHVsZSBwcm92aWRlcyBjZW50cmFsaXplZCBlcnJvciBoYW5kbGluZyBmb3IgdGhlIEFQSSxcbiAqIGluY2x1ZGluZyBjdXN0b20gZXJyb3IgY2xhc3NlcyBhbmQgZXJyb3IgZm9ybWF0dGluZy5cbiAqL1xuXG4vKipcbiAqIEJhc2UgQVBJIEVycm9yIGNsYXNzIHRoYXQgZXh0ZW5kcyBFcnJvciB3aXRoIGFkZGl0aW9uYWwgcHJvcGVydGllc1xuICovXG5leHBvcnQgY2xhc3MgQXBpRXJyb3IgZXh0ZW5kcyBFcnJvciB7XG4gIGNvbnN0cnVjdG9yKG1lc3NhZ2UsIHN0YXR1c0NvZGUsIGVycm9ycyA9IG51bGwpIHtcbiAgICBzdXBlcihtZXNzYWdlKTtcbiAgICB0aGlzLnN0YXR1c0NvZGUgPSBzdGF0dXNDb2RlO1xuICAgIHRoaXMuZXJyb3JzID0gZXJyb3JzO1xuICAgIHRoaXMubmFtZSA9IHRoaXMuY29uc3RydWN0b3IubmFtZTtcbiAgICBFcnJvci5jYXB0dXJlU3RhY2tUcmFjZSh0aGlzLCB0aGlzLmNvbnN0cnVjdG9yKTtcbiAgfVxufVxuXG4vKipcbiAqIDQwMCBCYWQgUmVxdWVzdCAtIFVzZWQgZm9yIGludmFsaWQgaW5wdXQsIG1pc3NpbmcgcmVxdWlyZWQgcGFyYW1ldGVycywgZXRjLlxuICovXG5leHBvcnQgY2xhc3MgQmFkUmVxdWVzdEVycm9yIGV4dGVuZHMgQXBpRXJyb3Ige1xuICBjb25zdHJ1Y3RvcihtZXNzYWdlID0gJ0JhZCBSZXF1ZXN0JywgZXJyb3JzID0gbnVsbCkge1xuICAgIHN1cGVyKG1lc3NhZ2UsIDQwMCwgZXJyb3JzKTtcbiAgfVxufVxuXG4vKipcbiAqIDQwMSBVbmF1dGhvcml6ZWQgLSBVc2VkIGZvciBhdXRoZW50aWNhdGlvbiBmYWlsdXJlc1xuICovXG5leHBvcnQgY2xhc3MgVW5hdXRob3JpemVkRXJyb3IgZXh0ZW5kcyBBcGlFcnJvciB7XG4gIGNvbnN0cnVjdG9yKG1lc3NhZ2UgPSAnTm8gYXV0b3JpemFkbycsIGVycm9ycyA9IG51bGwpIHtcbiAgICBzdXBlcihtZXNzYWdlLCA0MDEsIGVycm9ycyk7XG4gIH1cbn1cblxuLyoqXG4gKiA0MDMgRm9yYmlkZGVuIC0gVXNlZCBmb3IgYXV0aG9yaXphdGlvbiBmYWlsdXJlcyAoYXV0aGVudGljYXRlZCBidXQgbm90IGFsbG93ZWQpXG4gKi9cbmV4cG9ydCBjbGFzcyBGb3JiaWRkZW5FcnJvciBleHRlbmRzIEFwaUVycm9yIHtcbiAgY29uc3RydWN0b3IobWVzc2FnZSA9ICdBY2Nlc28gcHJvaGliaWRvJywgZXJyb3JzID0gbnVsbCkge1xuICAgIHN1cGVyKG1lc3NhZ2UsIDQwMywgZXJyb3JzKTtcbiAgfVxufVxuXG4vKipcbiAqIDQwNCBOb3QgRm91bmQgLSBVc2VkIHdoZW4gcmVzb3VyY2UgaXMgbm90IGZvdW5kXG4gKi9cbmV4cG9ydCBjbGFzcyBOb3RGb3VuZEVycm9yIGV4dGVuZHMgQXBpRXJyb3Ige1xuICBjb25zdHJ1Y3RvcihtZXNzYWdlID0gJ1JlY3Vyc28gbm8gZW5jb250cmFkbycsIGVycm9ycyA9IG51bGwpIHtcbiAgICBzdXBlcihtZXNzYWdlLCA0MDQsIGVycm9ycyk7XG4gIH1cbn1cblxuLyoqXG4gKiA0MjIgVW5wcm9jZXNzYWJsZSBFbnRpdHkgLSBVc2VkIGZvciB2YWxpZGF0aW9uIGVycm9yc1xuICovXG5leHBvcnQgY2xhc3MgVmFsaWRhdGlvbkVycm9yIGV4dGVuZHMgQXBpRXJyb3Ige1xuICBjb25zdHJ1Y3RvcihtZXNzYWdlID0gJ0Vycm9yIGRlIHZhbGlkYWNpw7NuJywgZXJyb3JzID0gbnVsbCkge1xuICAgIHN1cGVyKG1lc3NhZ2UsIDQyMiwgZXJyb3JzKTtcbiAgfVxufVxuXG4vKipcbiAqIDQyOSBUb28gTWFueSBSZXF1ZXN0cyAtIFVzZWQgZm9yIHJhdGUgbGltaXRpbmdcbiAqL1xuZXhwb3J0IGNsYXNzIFJhdGVMaW1pdEVycm9yIGV4dGVuZHMgQXBpRXJyb3Ige1xuICBjb25zdHJ1Y3RvcihtZXNzYWdlID0gJ0RlbWFzaWFkYXMgc29saWNpdHVkZXMnLCBlcnJvcnMgPSBudWxsKSB7XG4gICAgc3VwZXIobWVzc2FnZSwgNDI5LCBlcnJvcnMpO1xuICB9XG59XG5cbi8qKlxuICogNTAwIEludGVybmFsIFNlcnZlciBFcnJvciAtIFVzZWQgZm9yIHNlcnZlciBlcnJvcnNcbiAqL1xuZXhwb3J0IGNsYXNzIEludGVybmFsU2VydmVyRXJyb3IgZXh0ZW5kcyBBcGlFcnJvciB7XG4gIGNvbnN0cnVjdG9yKG1lc3NhZ2UgPSAnRXJyb3IgaW50ZXJubyBkZWwgc2Vydmlkb3InLCBlcnJvcnMgPSBudWxsKSB7XG4gICAgc3VwZXIobWVzc2FnZSwgNTAwLCBlcnJvcnMpO1xuICB9XG59XG5cbi8qKlxuICogTG9nIGFuIGVycm9yIHdpdGggY29udGV4dHVhbCBpbmZvcm1hdGlvblxuICogXG4gKiBAcGFyYW0ge0Vycm9yfSBlcnJvciAtIFRoZSBlcnJvciB0byBsb2dcbiAqIEBwYXJhbSB7T2JqZWN0fSByZXEgLSBUaGUgcmVxdWVzdCBvYmplY3RcbiAqL1xuZXhwb3J0IGNvbnN0IGxvZ0Vycm9yID0gKGVycm9yLCByZXEgPSBudWxsKSA9PiB7XG4gIGNvbnN0IHRpbWVzdGFtcCA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKTtcbiAgY29uc3QgZXJyb3JUeXBlID0gZXJyb3IubmFtZSB8fCAnRXJyb3InO1xuICBjb25zdCBwYXRoID0gcmVxID8gYCR7cmVxLm1ldGhvZH0gJHtyZXEudXJsfWAgOiAnVW5rbm93biBwYXRoJztcbiAgY29uc3QgdXNlcklkID0gcmVxICYmIHJlcS51c2VySWQgPyByZXEudXNlcklkIDogJ1VuYXV0aGVudGljYXRlZCc7XG4gIFxuICAvLyBCYXNpYyBlcnJvciBpbmZvcm1hdGlvbiBmb3IgdGhlIGxvZ1xuICBjb25zdCBsb2dEYXRhID0ge1xuICAgIHRpbWVzdGFtcCxcbiAgICBlcnJvclR5cGUsXG4gICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSxcbiAgICBwYXRoLFxuICAgIHVzZXJJZCxcbiAgICBzdGF0dXNDb2RlOiBlcnJvci5zdGF0dXNDb2RlIHx8IDUwMFxuICB9O1xuICBcbiAgLy8gQWRkIHN0YWNrIHRyYWNlIGluIGRldmVsb3BtZW50XG4gIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nKSB7XG4gICAgbG9nRGF0YS5zdGFjayA9IGVycm9yLnN0YWNrO1xuICB9XG4gIFxuICAvLyBBZGQgdmFsaWRhdGlvbiBlcnJvcnMgaWYgYXZhaWxhYmxlXG4gIGlmIChlcnJvci5lcnJvcnMpIHtcbiAgICBsb2dEYXRhLnZhbGlkYXRpb25FcnJvcnMgPSBlcnJvci5lcnJvcnM7XG4gIH1cbiAgXG4gIC8vIExvZyB0aGUgZXJyb3JcbiAgY29uc29sZS5lcnJvcignQVBJIEVSUk9SOicsIGxvZ0RhdGEpO1xufTtcblxuLyoqXG4gKiBGb3JtYXQgYW4gZXJyb3IgcmVzcG9uc2UgdG8gYmUgc2VudCB0byB0aGUgY2xpZW50XG4gKiBcbiAqIEBwYXJhbSB7RXJyb3J9IGVycm9yIC0gVGhlIGVycm9yIHRvIGZvcm1hdFxuICogQHBhcmFtIHtib29sZWFufSBpbmNsdWRlRGV0YWlscyAtIFdoZXRoZXIgdG8gaW5jbHVkZSBlcnJvciBkZXRhaWxzIChmb3IgZGV2ZWxvcG1lbnQpXG4gKiBAcmV0dXJucyB7T2JqZWN0fSAtIEZvcm1hdHRlZCBlcnJvciByZXNwb25zZVxuICovXG5leHBvcnQgY29uc3QgZm9ybWF0RXJyb3JSZXNwb25zZSA9IChlcnJvciwgaW5jbHVkZURldGFpbHMgPSBmYWxzZSkgPT4ge1xuICAvLyBEZWZhdWx0IGVycm9yIHJlc3BvbnNlXG4gIGNvbnN0IGVycm9yUmVzcG9uc2UgPSB7XG4gICAgc3VjY2VzczogZmFsc2UsXG4gICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSB8fCAnQW4gdW5leHBlY3RlZCBlcnJvciBvY2N1cnJlZCcsXG4gICAgc3RhdHVzQ29kZTogZXJyb3Iuc3RhdHVzQ29kZSB8fCA1MDBcbiAgfTtcbiAgXG4gIC8vIEluY2x1ZGUgdmFsaWRhdGlvbiBlcnJvcnMgaWYgYXZhaWxhYmxlXG4gIGlmIChlcnJvci5lcnJvcnMpIHtcbiAgICBlcnJvclJlc3BvbnNlLmVycm9ycyA9IGVycm9yLmVycm9ycztcbiAgfVxuICBcbiAgLy8gSW5jbHVkZSBlcnJvciBkZXRhaWxzIGluIGRldmVsb3BtZW50XG4gIGlmIChpbmNsdWRlRGV0YWlscyAmJiBwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nKSB7XG4gICAgZXJyb3JSZXNwb25zZS5zdGFjayA9IGVycm9yLnN0YWNrO1xuICAgIGVycm9yUmVzcG9uc2UubmFtZSA9IGVycm9yLm5hbWU7XG4gIH1cbiAgXG4gIHJldHVybiBlcnJvclJlc3BvbnNlO1xufTtcblxuLyoqXG4gKiBFcnJvciBoYW5kbGluZyBtaWRkbGV3YXJlIGZvciBBUEkgcm91dGVzXG4gKiBcbiAqIEBwYXJhbSB7RXJyb3J9IGVycm9yIC0gVGhlIGVycm9yIHRoYXQgb2NjdXJyZWRcbiAqIEBwYXJhbSB7T2JqZWN0fSByZXEgLSBUaGUgcmVxdWVzdCBvYmplY3RcbiAqIEBwYXJhbSB7T2JqZWN0fSByZXMgLSBUaGUgcmVzcG9uc2Ugb2JqZWN0XG4gKiBAcmV0dXJucyB7T2JqZWN0fSAtIEVycm9yIHJlc3BvbnNlXG4gKi9cbmV4cG9ydCBjb25zdCBoYW5kbGVBcGlFcnJvciA9IChlcnJvciwgcmVxLCByZXMpID0+IHtcbiAgLy8gTG9nIHRoZSBlcnJvclxuICBsb2dFcnJvcihlcnJvciwgcmVxKTtcbiAgXG4gIC8vIERldGVybWluZSBlcnJvciBzdGF0dXMgY29kZSAoZGVmYXVsdCB0byA1MDApXG4gIGNvbnN0IHN0YXR1c0NvZGUgPSBlcnJvci5zdGF0dXNDb2RlIHx8IDUwMDtcbiAgXG4gIC8vIEZvcm1hdCBlcnJvciByZXNwb25zZSBpbmNsdWRpbmcgZGV0YWlscyBpbiBub24tcHJvZHVjdGlvbiBlbnZpcm9ubWVudHNcbiAgY29uc3QgZXJyb3JSZXNwb25zZSA9IGZvcm1hdEVycm9yUmVzcG9uc2UoXG4gICAgZXJyb3IsXG4gICAgcHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJ1xuICApO1xuICBcbiAgLy8gU2VuZCBlcnJvciByZXNwb25zZVxuICByZXR1cm4gcmVzLnN0YXR1cyhzdGF0dXNDb2RlKS5qc29uKGVycm9yUmVzcG9uc2UpO1xufTtcblxuLyoqXG4gKiBNaWRkbGV3YXJlIHRvIGhhbmRsZSBzcGVjaWZpYyB0eXBlcyBvZiBlcnJvcnMgaW4gQVBJIHJvdXRlc1xuICogXG4gKiBAcGFyYW0ge0Z1bmN0aW9ufSBoYW5kbGVyIC0gVGhlIEFQSSByb3V0ZSBoYW5kbGVyXG4gKiBAcmV0dXJucyB7RnVuY3Rpb259IC0gRW5oYW5jZWQgaGFuZGxlciB3aXRoIGVycm9yIGhhbmRsaW5nXG4gKi9cbmV4cG9ydCBjb25zdCB3aXRoRXJyb3JIYW5kbGluZyA9IChoYW5kbGVyKSA9PiB7XG4gIHJldHVybiBhc3luYyAocmVxLCByZXMpID0+IHtcbiAgICB0cnkge1xuICAgICAgcmV0dXJuIGF3YWl0IGhhbmRsZXIocmVxLCByZXMpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICByZXR1cm4gaGFuZGxlQXBpRXJyb3IoZXJyb3IsIHJlcSwgcmVzKTtcbiAgICB9XG4gIH07XG59O1xuXG4iXSwibmFtZXMiOlsiQXBpRXJyb3IiLCJFcnJvciIsImNvbnN0cnVjdG9yIiwibWVzc2FnZSIsInN0YXR1c0NvZGUiLCJlcnJvcnMiLCJuYW1lIiwiY2FwdHVyZVN0YWNrVHJhY2UiLCJCYWRSZXF1ZXN0RXJyb3IiLCJVbmF1dGhvcml6ZWRFcnJvciIsIkZvcmJpZGRlbkVycm9yIiwiTm90Rm91bmRFcnJvciIsIlZhbGlkYXRpb25FcnJvciIsIlJhdGVMaW1pdEVycm9yIiwiSW50ZXJuYWxTZXJ2ZXJFcnJvciIsImxvZ0Vycm9yIiwiZXJyb3IiLCJyZXEiLCJ0aW1lc3RhbXAiLCJEYXRlIiwidG9JU09TdHJpbmciLCJlcnJvclR5cGUiLCJwYXRoIiwibWV0aG9kIiwidXJsIiwidXNlcklkIiwibG9nRGF0YSIsInByb2Nlc3MiLCJzdGFjayIsInZhbGlkYXRpb25FcnJvcnMiLCJjb25zb2xlIiwiZm9ybWF0RXJyb3JSZXNwb25zZSIsImluY2x1ZGVEZXRhaWxzIiwiZXJyb3JSZXNwb25zZSIsInN1Y2Nlc3MiLCJoYW5kbGVBcGlFcnJvciIsInJlcyIsInN0YXR1cyIsImpzb24iLCJ3aXRoRXJyb3JIYW5kbGluZyIsImhhbmRsZXIiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api-node)/./lib/middleware/error.js\n");

/***/ }),

/***/ "(api-node)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fhealth&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fhealth.js&middlewareConfigBase64=e30%3D!":
/*!******************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fhealth&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fhealth.js&middlewareConfigBase64=e30%3D! ***!
  \******************************************************************************************************************************************************************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/route-modules/pages-api/module.compiled */ \"(api-node)/./node_modules/next/dist/server/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/route-kind */ \"(api-node)/./node_modules/next/dist/server/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api-node)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _pages_api_health_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./pages/api/health.js */ \"(api-node)/./pages/api/health.js\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_pages_api_health_js__WEBPACK_IMPORTED_MODULE_3__]);\n_pages_api_health_js__WEBPACK_IMPORTED_MODULE_3__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_health_js__WEBPACK_IMPORTED_MODULE_3__, 'default'));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_health_js__WEBPACK_IMPORTED_MODULE_3__, 'config');\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/health\",\n        pathname: \"/api/health\",\n        // The following aren't used in production.\n        bundlePath: '',\n        filename: ''\n    },\n    userland: _pages_api_health_js__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL25vZGVfbW9kdWxlcy9uZXh0L2Rpc3QvYnVpbGQvd2VicGFjay9sb2FkZXJzL25leHQtcm91dGUtbG9hZGVyL2luZGV4LmpzP2tpbmQ9UEFHRVNfQVBJJnBhZ2U9JTJGYXBpJTJGaGVhbHRoJnByZWZlcnJlZFJlZ2lvbj0mYWJzb2x1dGVQYWdlUGF0aD0uJTJGcGFnZXMlMkZhcGklMkZoZWFsdGguanMmbWlkZGxld2FyZUNvbmZpZ0Jhc2U2ND1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7O0FBQStGO0FBQ3ZDO0FBQ0U7QUFDMUQ7QUFDa0Q7QUFDbEQ7QUFDQSxpRUFBZSx3RUFBSyxDQUFDLGlEQUFRLFlBQVksRUFBQztBQUMxQztBQUNPLGVBQWUsd0VBQUssQ0FBQyxpREFBUTtBQUNwQztBQUNPLHdCQUF3Qix5R0FBbUI7QUFDbEQ7QUFDQSxjQUFjLGtFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsWUFBWTtBQUNaLENBQUM7O0FBRUQscUMiLCJzb3VyY2VzIjpbIiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQYWdlc0FQSVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvcm91dGUtbW9kdWxlcy9wYWdlcy1hcGkvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBob2lzdCB9IGZyb20gXCJuZXh0L2Rpc3QvYnVpbGQvdGVtcGxhdGVzL2hlbHBlcnNcIjtcbi8vIEltcG9ydCB0aGUgdXNlcmxhbmQgY29kZS5cbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCIuL3BhZ2VzL2FwaS9oZWFsdGguanNcIjtcbi8vIFJlLWV4cG9ydCB0aGUgaGFuZGxlciAoc2hvdWxkIGJlIHRoZSBkZWZhdWx0IGV4cG9ydCkuXG5leHBvcnQgZGVmYXVsdCBob2lzdCh1c2VybGFuZCwgJ2RlZmF1bHQnKTtcbi8vIFJlLWV4cG9ydCBjb25maWcuXG5leHBvcnQgY29uc3QgY29uZmlnID0gaG9pc3QodXNlcmxhbmQsICdjb25maWcnKTtcbi8vIENyZWF0ZSBhbmQgZXhwb3J0IHRoZSByb3V0ZSBtb2R1bGUgdGhhdCB3aWxsIGJlIGNvbnN1bWVkLlxuZXhwb3J0IGNvbnN0IHJvdXRlTW9kdWxlID0gbmV3IFBhZ2VzQVBJUm91dGVNb2R1bGUoe1xuICAgIGRlZmluaXRpb246IHtcbiAgICAgICAga2luZDogUm91dGVLaW5kLlBBR0VTX0FQSSxcbiAgICAgICAgcGFnZTogXCIvYXBpL2hlYWx0aFwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL2hlYWx0aFwiLFxuICAgICAgICAvLyBUaGUgZm9sbG93aW5nIGFyZW4ndCB1c2VkIGluIHByb2R1Y3Rpb24uXG4gICAgICAgIGJ1bmRsZVBhdGg6ICcnLFxuICAgICAgICBmaWxlbmFtZTogJydcbiAgICB9LFxuICAgIHVzZXJsYW5kXG59KTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9cGFnZXMtYXBpLmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api-node)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fhealth&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fhealth.js&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api-node)/./pages/api/health.js":
/*!*****************************!*\
  !*** ./pages/api/health.js ***!
  \*****************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var _lib_db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/db */ \"(api-node)/./lib/db.js\");\n/* harmony import */ var _lib_api_router__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../lib/api/router */ \"(api-node)/./lib/api/router.js\");\n/* harmony import */ var os__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! os */ \"os\");\n/* harmony import */ var os__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(os__WEBPACK_IMPORTED_MODULE_2__);\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_lib_db__WEBPACK_IMPORTED_MODULE_0__]);\n_lib_db__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n/**\n * API Health Check Endpoint\n * \n * Provides health status information about the API service, including:\n * - Database connection status\n * - System status\n * - Performance metrics\n * - Environment information\n */ \n\n\n/**\n * Calculate system uptime in a human-readable format\n * \n * @returns {string} Human readable uptime\n */ function getReadableUptime() {\n    const uptimeSec = os__WEBPACK_IMPORTED_MODULE_2___default().uptime();\n    const days = Math.floor(uptimeSec / (3600 * 24));\n    const hours = Math.floor(uptimeSec % (3600 * 24) / 3600);\n    const minutes = Math.floor(uptimeSec % 3600 / 60);\n    const seconds = Math.floor(uptimeSec % 60);\n    return `${days}d ${hours}h ${minutes}m ${seconds}s`;\n}\n/**\n * Get system resource usage metrics\n * \n * @returns {Object} System metrics\n */ function getSystemMetrics() {\n    const totalMem = os__WEBPACK_IMPORTED_MODULE_2___default().totalmem();\n    const freeMem = os__WEBPACK_IMPORTED_MODULE_2___default().freemem();\n    const usedMem = totalMem - freeMem;\n    return {\n        cpu: {\n            cores: os__WEBPACK_IMPORTED_MODULE_2___default().cpus().length,\n            model: os__WEBPACK_IMPORTED_MODULE_2___default().cpus()[0].model,\n            load: os__WEBPACK_IMPORTED_MODULE_2___default().loadavg()\n        },\n        memory: {\n            total: Math.round(totalMem / (1024 * 1024)) + 'MB',\n            free: Math.round(freeMem / (1024 * 1024)) + 'MB',\n            used: Math.round(usedMem / (1024 * 1024)) + 'MB',\n            usagePercentage: Math.round(usedMem / totalMem * 100) + '%'\n        },\n        uptime: getReadableUptime(),\n        platform: os__WEBPACK_IMPORTED_MODULE_2___default().platform(),\n        hostname: os__WEBPACK_IMPORTED_MODULE_2___default().hostname(),\n        nodeVersion: process.version\n    };\n}\n/**\n * Handle GET request for health status\n * \n * @param {Object} req - The request object\n * @param {Object} res - The response object\n */ async function getHealthStatus(req, res) {\n    const startTime = process.hrtime();\n    // Check database connection\n    let dbStatus = 'ok';\n    let dbResponseTime = 0;\n    try {\n        const dbStartTime = process.hrtime();\n        await _lib_db__WEBPACK_IMPORTED_MODULE_0__[\"default\"].query('SELECT 1');\n        const dbTimeDiff = process.hrtime(dbStartTime);\n        dbResponseTime = (dbTimeDiff[0] * 1e9 + dbTimeDiff[1]) / 1e6; // Convert to ms\n    } catch (error) {\n        dbStatus = 'error';\n        console.error('Database health check failed:', error);\n    }\n    // Calculate API response time\n    const timeDiff = process.hrtime(startTime);\n    const responseTime = (timeDiff[0] * 1e9 + timeDiff[1]) / 1e6; // Convert to ms\n    // Get version information\n    const appVersion = process.env.npm_package_version || '1.0.0';\n    // Compile health information\n    const healthInfo = {\n        status: dbStatus === 'ok' ? 'ok' : 'degraded',\n        timestamp: new Date().toISOString(),\n        version: appVersion,\n        environment: \"development\" || 0,\n        database: {\n            status: dbStatus,\n            responseTime: `${dbResponseTime.toFixed(2)}ms`\n        },\n        system: getSystemMetrics(),\n        performance: {\n            responseTime: `${responseTime.toFixed(2)}ms`\n        }\n    };\n    return res.status(200).json((0,_lib_api_router__WEBPACK_IMPORTED_MODULE_1__.formatSuccess)(healthInfo, 'Health check completed'));\n}\n// Register the health check route with minimal middleware\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_api_router__WEBPACK_IMPORTED_MODULE_1__.registerRoutes)({\n    GET: getHealthStatus\n}, {\n    // No auth required for health checks\n    auth: false,\n    // Apply rate limiting to prevent abuse\n    rateLimit: {\n        maxRequests: 60,\n        windowMs: 60 * 1000 // 1 minute\n    }\n}));\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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RSxDQUFDO1FBQzlDO0lBQ0Y7SUFFQSxPQUFPdEIsSUFBSWdCLE1BQU0sQ0FBQyxLQUFLUyxJQUFJLENBQ3pCOUQsOERBQWFBLENBQ1hvRCxZQUNBO0FBR047QUFFQSwwREFBMEQ7QUFDMUQsaUVBQWVyRCwrREFBY0EsQ0FDM0I7SUFDRWdFLEtBQUs1QjtBQUNQLEdBQ0E7SUFDRSxxQ0FBcUM7SUFDckM2QixNQUFNO0lBQ04sdUNBQXVDO0lBQ3ZDQyxXQUFXO1FBQ1RDLGFBQWE7UUFDYkMsVUFBVSxLQUFLLEtBQUssV0FBVztJQUNqQztBQUNGLElBQ0EiLCJzb3VyY2VzIjpbIi9Vc2Vycy9rZXZpbnp1bmlnYS9EZXZlbG9wbWVudC9rZXZpbi9mbG93YXBwL21vbmV5LWZsb3cvcGFnZXMvYXBpL2hlYWx0aC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEFQSSBIZWFsdGggQ2hlY2sgRW5kcG9pbnRcbiAqIFxuICogUHJvdmlkZXMgaGVhbHRoIHN0YXR1cyBpbmZvcm1hdGlvbiBhYm91dCB0aGUgQVBJIHNlcnZpY2UsIGluY2x1ZGluZzpcbiAqIC0gRGF0YWJhc2UgY29ubmVjdGlvbiBzdGF0dXNcbiAqIC0gU3lzdGVtIHN0YXR1c1xuICogLSBQZXJmb3JtYW5jZSBtZXRyaWNzXG4gKiAtIEVudmlyb25tZW50IGluZm9ybWF0aW9uXG4gKi9cblxuaW1wb3J0IGRiIGZyb20gJy4uLy4uL2xpYi9kYic7XG5pbXBvcnQgeyByZWdpc3RlclJvdXRlcywgZm9ybWF0U3VjY2VzcyB9IGZyb20gJy4uLy4uL2xpYi9hcGkvcm91dGVyJztcbmltcG9ydCBvcyBmcm9tICdvcyc7XG5cbi8qKlxuICogQ2FsY3VsYXRlIHN5c3RlbSB1cHRpbWUgaW4gYSBodW1hbi1yZWFkYWJsZSBmb3JtYXRcbiAqIFxuICogQHJldHVybnMge3N0cmluZ30gSHVtYW4gcmVhZGFibGUgdXB0aW1lXG4gKi9cbmZ1bmN0aW9uIGdldFJlYWRhYmxlVXB0aW1lKCkge1xuICBjb25zdCB1cHRpbWVTZWMgPSBvcy51cHRpbWUoKTtcbiAgY29uc3QgZGF5cyA9IE1hdGguZmxvb3IodXB0aW1lU2VjIC8gKDM2MDAgKiAyNCkpO1xuICBjb25zdCBob3VycyA9IE1hdGguZmxvb3IoKHVwdGltZVNlYyAlICgzNjAwICogMjQpKSAvIDM2MDApO1xuICBjb25zdCBtaW51dGVzID0gTWF0aC5mbG9vcigodXB0aW1lU2VjICUgMzYwMCkgLyA2MCk7XG4gIGNvbnN0IHNlY29uZHMgPSBNYXRoLmZsb29yKHVwdGltZVNlYyAlIDYwKTtcbiAgXG4gIHJldHVybiBgJHtkYXlzfWQgJHtob3Vyc31oICR7bWludXRlc31tICR7c2Vjb25kc31zYDtcbn1cblxuLyoqXG4gKiBHZXQgc3lzdGVtIHJlc291cmNlIHVzYWdlIG1ldHJpY3NcbiAqIFxuICogQHJldHVybnMge09iamVjdH0gU3lzdGVtIG1ldHJpY3NcbiAqL1xuZnVuY3Rpb24gZ2V0U3lzdGVtTWV0cmljcygpIHtcbiAgY29uc3QgdG90YWxNZW0gPSBvcy50b3RhbG1lbSgpO1xuICBjb25zdCBmcmVlTWVtID0gb3MuZnJlZW1lbSgpO1xuICBjb25zdCB1c2VkTWVtID0gdG90YWxNZW0gLSBmcmVlTWVtO1xuICBcbiAgcmV0dXJuIHtcbiAgICBjcHU6IHtcbiAgICAgIGNvcmVzOiBvcy5jcHVzKCkubGVuZ3RoLFxuICAgICAgbW9kZWw6IG9zLmNwdXMoKVswXS5tb2RlbCxcbiAgICAgIGxvYWQ6IG9zLmxvYWRhdmcoKVxuICAgIH0sXG4gICAgbWVtb3J5OiB7XG4gICAgICB0b3RhbDogTWF0aC5yb3VuZCh0b3RhbE1lbSAvICgxMDI0ICogMTAyNCkpICsgJ01CJyxcbiAgICAgIGZyZWU6IE1hdGgucm91bmQoZnJlZU1lbSAvICgxMDI0ICogMTAyNCkpICsgJ01CJyxcbiAgICAgIHVzZWQ6IE1hdGgucm91bmQodXNlZE1lbSAvICgxMDI0ICogMTAyNCkpICsgJ01CJyxcbiAgICAgIHVzYWdlUGVyY2VudGFnZTogTWF0aC5yb3VuZCgodXNlZE1lbSAvIHRvdGFsTWVtKSAqIDEwMCkgKyAnJSdcbiAgICB9LFxuICAgIHVwdGltZTogZ2V0UmVhZGFibGVVcHRpbWUoKSxcbiAgICBwbGF0Zm9ybTogb3MucGxhdGZvcm0oKSxcbiAgICBob3N0bmFtZTogb3MuaG9zdG5hbWUoKSxcbiAgICBub2RlVmVyc2lvbjogcHJvY2Vzcy52ZXJzaW9uXG4gIH07XG59XG5cbi8qKlxuICogSGFuZGxlIEdFVCByZXF1ZXN0IGZvciBoZWFsdGggc3RhdHVzXG4gKiBcbiAqIEBwYXJhbSB7T2JqZWN0fSByZXEgLSBUaGUgcmVxdWVzdCBvYmplY3RcbiAqIEBwYXJhbSB7T2JqZWN0fSByZXMgLSBUaGUgcmVzcG9uc2Ugb2JqZWN0XG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGdldEhlYWx0aFN0YXR1cyhyZXEsIHJlcykge1xuICBjb25zdCBzdGFydFRpbWUgPSBwcm9jZXNzLmhydGltZSgpO1xuICBcbiAgLy8gQ2hlY2sgZGF0YWJhc2UgY29ubmVjdGlvblxuICBsZXQgZGJTdGF0dXMgPSAnb2snO1xuICBsZXQgZGJSZXNwb25zZVRpbWUgPSAwO1xuICBcbiAgdHJ5IHtcbiAgICBjb25zdCBkYlN0YXJ0VGltZSA9IHByb2Nlc3MuaHJ0aW1lKCk7XG4gICAgYXdhaXQgZGIucXVlcnkoJ1NFTEVDVCAxJyk7XG4gICAgY29uc3QgZGJUaW1lRGlmZiA9IHByb2Nlc3MuaHJ0aW1lKGRiU3RhcnRUaW1lKTtcbiAgICBkYlJlc3BvbnNlVGltZSA9IChkYlRpbWVEaWZmWzBdICogMWU5ICsgZGJUaW1lRGlmZlsxXSkgLyAxZTY7IC8vIENvbnZlcnQgdG8gbXNcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBkYlN0YXR1cyA9ICdlcnJvcic7XG4gICAgY29uc29sZS5lcnJvcignRGF0YWJhc2UgaGVhbHRoIGNoZWNrIGZhaWxlZDonLCBlcnJvcik7XG4gIH1cbiAgXG4gIC8vIENhbGN1bGF0ZSBBUEkgcmVzcG9uc2UgdGltZVxuICBjb25zdCB0aW1lRGlmZiA9IHByb2Nlc3MuaHJ0aW1lKHN0YXJ0VGltZSk7XG4gIGNvbnN0IHJlc3BvbnNlVGltZSA9ICh0aW1lRGlmZlswXSAqIDFlOSArIHRpbWVEaWZmWzFdKSAvIDFlNjsgLy8gQ29udmVydCB0byBtc1xuICBcbiAgLy8gR2V0IHZlcnNpb24gaW5mb3JtYXRpb25cbiAgY29uc3QgYXBwVmVyc2lvbiA9IHByb2Nlc3MuZW52Lm5wbV9wYWNrYWdlX3ZlcnNpb24gfHwgJzEuMC4wJztcbiAgXG4gIC8vIENvbXBpbGUgaGVhbHRoIGluZm9ybWF0aW9uXG4gIGNvbnN0IGhlYWx0aEluZm8gPSB7XG4gICAgc3RhdHVzOiBkYlN0YXR1cyA9PT0gJ29rJyA/ICdvaycgOiAnZGVncmFkZWQnLFxuICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgIHZlcnNpb246IGFwcFZlcnNpb24sXG4gICAgZW52aXJvbm1lbnQ6IHByb2Nlc3MuZW52Lk5PREVfRU5WIHx8ICdkZXZlbG9wbWVudCcsXG4gICAgZGF0YWJhc2U6IHtcbiAgICAgIHN0YXR1czogZGJTdGF0dXMsXG4gICAgICByZXNwb25zZVRpbWU6IGAke2RiUmVzcG9uc2VUaW1lLnRvRml4ZWQoMil9bXNgXG4gICAgfSxcbiAgICBzeXN0ZW06IGdldFN5c3RlbU1ldHJpY3MoKSxcbiAgICBwZXJmb3JtYW5jZToge1xuICAgICAgcmVzcG9uc2VUaW1lOiBgJHtyZXNwb25zZVRpbWUudG9GaXhlZCgyKX1tc2BcbiAgICB9XG4gIH07XG4gIFxuICByZXR1cm4gcmVzLnN0YXR1cygyMDApLmpzb24oXG4gICAgZm9ybWF0U3VjY2VzcyhcbiAgICAgIGhlYWx0aEluZm8sXG4gICAgICAnSGVhbHRoIGNoZWNrIGNvbXBsZXRlZCdcbiAgICApXG4gICk7XG59XG5cbi8vIFJlZ2lzdGVyIHRoZSBoZWFsdGggY2hlY2sgcm91dGUgd2l0aCBtaW5pbWFsIG1pZGRsZXdhcmVcbmV4cG9ydCBkZWZhdWx0IHJlZ2lzdGVyUm91dGVzKFxuICB7XG4gICAgR0VUOiBnZXRIZWFsdGhTdGF0dXNcbiAgfSxcbiAge1xuICAgIC8vIE5vIGF1dGggcmVxdWlyZWQgZm9yIGhlYWx0aCBjaGVja3NcbiAgICBhdXRoOiBmYWxzZSxcbiAgICAvLyBBcHBseSByYXRlIGxpbWl0aW5nIHRvIHByZXZlbnQgYWJ1c2VcbiAgICByYXRlTGltaXQ6IHtcbiAgICAgIG1heFJlcXVlc3RzOiA2MCxcbiAgICAgIHdpbmRvd01zOiA2MCAqIDEwMDAgLy8gMSBtaW51dGVcbiAgICB9XG4gIH1cbik7XG5cbiJdLCJuYW1lcyI6WyJkYiIsInJlZ2lzdGVyUm91dGVzIiwiZm9ybWF0U3VjY2VzcyIsIm9zIiwiZ2V0UmVhZGFibGVVcHRpbWUiLCJ1cHRpbWVTZWMiLCJ1cHRpbWUiLCJkYXlzIiwiTWF0aCIsImZsb29yIiwiaG91cnMiLCJtaW51dGVzIiwic2Vjb25kcyIsImdldFN5c3RlbU1ldHJpY3MiLCJ0b3RhbE1lbSIsInRvdGFsbWVtIiwiZnJlZU1lbSIsImZyZWVtZW0iLCJ1c2VkTWVtIiwiY3B1IiwiY29yZXMiLCJjcHVzIiwibGVuZ3RoIiwibW9kZWwiLCJsb2FkIiwibG9hZGF2ZyIsIm1lbW9yeSIsInRvdGFsIiwicm91bmQiLCJmcmVlIiwidXNlZCIsInVzYWdlUGVyY2VudGFnZSIsInBsYXRmb3JtIiwiaG9zdG5hbWUiLCJub2RlVmVyc2lvbiIsInByb2Nlc3MiLCJ2ZXJzaW9uIiwiZ2V0SGVhbHRoU3RhdHVzIiwicmVxIiwicmVzIiwic3RhcnRUaW1lIiwiaHJ0aW1lIiwiZGJTdGF0dXMiLCJkYlJlc3BvbnNlVGltZSIsImRiU3RhcnRUaW1lIiwicXVlcnkiLCJkYlRpbWVEaWZmIiwiZXJyb3IiLCJjb25zb2xlIiwidGltZURpZmYiLCJyZXNwb25zZVRpbWUiLCJhcHBWZXJzaW9uIiwiZW52IiwibnBtX3BhY2thZ2VfdmVyc2lvbiIsImhlYWx0aEluZm8iLCJzdGF0dXMiLCJ0aW1lc3RhbXAiLCJEYXRlIiwidG9JU09TdHJpbmciLCJlbnZpcm9ubWVudCIsImRhdGFiYXNlIiwidG9GaXhlZCIsInN5c3RlbSIsInBlcmZvcm1hbmNlIiwianNvbiIsIkdFVCIsImF1dGgiLCJyYXRlTGltaXQiLCJtYXhSZXF1ZXN0cyIsIndpbmRvd01zIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api-node)/./pages/api/health.js\n");

/***/ }),

/***/ "cookie":
/*!*************************!*\
  !*** external "cookie" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("cookie");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "jsonwebtoken":
/*!*******************************!*\
  !*** external "jsonwebtoken" ***!
  \*******************************/
/***/ ((module) => {

module.exports = require("jsonwebtoken");

/***/ }),

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "os":
/*!*********************!*\
  !*** external "os" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("os");

/***/ }),

/***/ "pg":
/*!*********************!*\
  !*** external "pg" ***!
  \*********************/
/***/ ((module) => {

module.exports = import("pg");;

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api-node)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fhealth&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fhealth.js&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();